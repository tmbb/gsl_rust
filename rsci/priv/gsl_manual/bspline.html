

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Basis Splines &mdash; GSL 2.8 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sparse Matrices" href="spmatrix.html" />
    <link rel="prev" title="Nonlinear Least-Squares Fitting" href="nls.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> GSL
          

          
          </a>

          
            
            
              <div class="version">
                2.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Using the Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="err.html">Error Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="math.html">Mathematical Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="complex.html">Complex Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="poly.html">Polynomials</a></li>
<li class="toctree-l1"><a class="reference internal" href="specfunc.html">Special Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="vectors.html">Vectors and Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="permutation.html">Permutations</a></li>
<li class="toctree-l1"><a class="reference internal" href="combination.html">Combinations</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiset.html">Multisets</a></li>
<li class="toctree-l1"><a class="reference internal" href="sort.html">Sorting</a></li>
<li class="toctree-l1"><a class="reference internal" href="blas.html">BLAS Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="linalg.html">Linear Algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="eigen.html">Eigensystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="fft.html">Fast Fourier Transforms (FFTs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Numerical Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="rng.html">Random Number Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="qrng.html">Quasi-Random Sequences</a></li>
<li class="toctree-l1"><a class="reference internal" href="randist.html">Random Number Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="rstat.html">Running Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="movstat.html">Moving Window Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="filter.html">Digital Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="histogram.html">Histograms</a></li>
<li class="toctree-l1"><a class="reference internal" href="ntuple.html">N-tuples</a></li>
<li class="toctree-l1"><a class="reference internal" href="montecarlo.html">Monte Carlo Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="siman.html">Simulated Annealing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ode-initval.html">Ordinary Differential Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="interp.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="diff.html">Numerical Differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheb.html">Chebyshev Approximations</a></li>
<li class="toctree-l1"><a class="reference internal" href="sum.html">Series Acceleration</a></li>
<li class="toctree-l1"><a class="reference internal" href="dwt.html">Wavelet Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="dht.html">Discrete Hankel Transforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="roots.html">One Dimensional Root-Finding</a></li>
<li class="toctree-l1"><a class="reference internal" href="min.html">One Dimensional Minimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiroots.html">Multidimensional Root-Finding</a></li>
<li class="toctree-l1"><a class="reference internal" href="multimin.html">Multidimensional Minimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="lls.html">Linear Least-Squares Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="nls.html">Nonlinear Least-Squares Fitting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basis Splines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vector-splines">Vector Splines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#knot-vector">Knot vector</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#allocation-of-b-splines">Allocation of B-splines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initializing-the-knots-vector">Initializing the knots vector</a></li>
<li class="toctree-l2"><a class="reference internal" href="#properties-of-b-splines">Properties of B-splines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#evaluation-of-b-splines">Evaluation of B-splines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#evaluation-of-b-spline-derivatives">Evaluation of B-spline derivatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#evaluation-of-b-spline-integrals">Evaluation of B-spline integrals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#least-squares-fitting-with-b-splines">Least Squares Fitting with B-splines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#periodic-spline-fitting">Periodic Spline Fitting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gram-matrix">Gram Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interpolation-with-b-splines">Interpolation with B-splines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hermite-interpolation-with-b-splines">Hermite Interpolation with B-splines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#projection-onto-the-b-spline-basis">Projection onto the B-spline Basis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#greville-abscissae">Greville abscissae</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-1-basis-splines-and-uniform-knots">Example 1: Basis Splines and Uniform Knots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-2-derivatives-of-basis-splines">Example 2: Derivatives of Basis Splines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-3-least-squares-and-breakpoints">Example 3: Least squares and breakpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-4-least-squares-and-spline-order">Example 4: Least squares and spline order</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-5-least-squares-regularization-and-the-gram-matrix">Example 5: Least squares, regularization and the Gram matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-6-least-squares-and-endpoint-regularization">Example 6: Least squares and endpoint regularization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-7-least-squares-and-periodic-splines">Example 7: Least squares and periodic splines</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-8-projecting-onto-the-b-spline-basis">Example 8: Projecting onto the B-spline basis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-9-interpolation">Example 9: Interpolation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#references-and-further-reading">References and Further Reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spmatrix.html">Sparse Matrices</a></li>
<li class="toctree-l1"><a class="reference internal" href="spblas.html">Sparse BLAS Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="splinalg.html">Sparse Linear Algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="const.html">Physical Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="ieee754.html">IEEE floating-point arithmetic</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debugging Numerical Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Contributors to GSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoconf.html">Autoconf Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="cblas.html">GSL CBLAS Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpl.html">GNU General Public License</a></li>
<li class="toctree-l1"><a class="reference internal" href="fdl.html">GNU Free Documentation License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GSL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Basis Splines</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/bspline.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="spmatrix.html" class="btn btn-neutral float-right" title="Sparse Matrices" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="nls.html" class="btn btn-neutral float-left" title="Nonlinear Least-Squares Fitting" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basis-splines">
<span id="chap-basis-splines"></span><span id="index-0"></span><h1>Basis Splines<a class="headerlink" href="#basis-splines" title="Permalink to this heading">¶</a></h1>
<p>This chapter describes functions for the computation of smoothing
basis splines (B-splines). A smoothing spline differs from an
interpolating spline in that the resulting curve is not required to
pass through each data point.  For information about
interpolating splines, see <a class="reference internal" href="interp.html#sec-interpolation"><span class="std std-ref">Interpolation</span></a>.</p>
<p>The header file <code class="file docutils literal notranslate"><span class="pre">gsl_bspline.h</span></code> contains the prototypes for the
bspline functions and related declarations.</p>
<div class="section" id="overview">
<span id="index-1"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>Basis splines are commonly used to fit smooth curves to data sets.
They are defined on some interval <img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/> which is sub-divided
into smaller intervals by defining a non-decreasing sequence of <em>knots</em>.
Between any two adjacent knots, a B-spline of order <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/> is a
polynomial of degree <img class="math" src="_images/math/4c7ea67e12bcbba0d5be6a3914a0eb2d17ef2cd7.png" alt="k-1"/>, and so B-splines defined over the
whole interval <img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/> are called <em>piecewise polynomials</em>. In
order to generate a smooth spline spanning the full interval, the
different polynomial pieces are often required to match one or more
derivatives at the knots.</p>
<p>B-splines of order <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/> are basis functions
for spline functions of the same order, so that all possible spline
functions on some interval <img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/> can be expressed as linear combinations
of B-splines,</p>
<div class="math">
<p><img src="_images/math/062871a8a1af900270354975e9b4fbee7aac21db.png" alt="f(x; \mathbf{t}) = \sum_{i=1}^n c_i B_{i,k}(x; \mathbf{t}), \quad a \le x \le b"/></p>
</div><p>Here, the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> coefficients <img class="math" src="_images/math/8f3ed3aa23232b84b9d4f7e1d0068c62e5869384.png" alt="c_i"/> are known as
<em>control points</em> and are often determined from a least squares fit.
The <img class="math" src="_images/math/6d7346e68c48fc432c238b3f67fd292ea13215b2.png" alt="B_{i,k}(x; \mathbf{t})"/> are the basis splines of order <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>,
and depend on a knot vector <img class="math" src="_images/math/b6299704b700d9d4a7ba17e0c3f8bf4d4d03e43b.png" alt="\mathbf{t}"/>, which is a non-decreasing
sequence of <img class="math" src="_images/math/944c48169bb2b215ca470e245fcda1c1b4b3cf59.png" alt="n + k"/> knots</p>
<div class="math">
<p><img src="_images/math/dc24467bb1f68ac15ff31b7c3e58840e8f5cf614.png" alt="\mathbf{t} = \left\{ t_1, t_2, \dots, t_{n + k} \right\}"/></p>
</div><p>On each knot interval <img class="math" src="_images/math/87ff34d469a1fdc722f9cdc0c1836d05c128b658.png" alt="t_i \le x &lt; t_{i+1}"/>, the B-splines <img class="math" src="_images/math/15ff485ecd32509c891e716803fac71281ba33e1.png" alt="B_{i,k}(x;\mathbf{t})"/>
are polynomials of degree <img class="math" src="_images/math/4c7ea67e12bcbba0d5be6a3914a0eb2d17ef2cd7.png" alt="k-1"/>.
The <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> basis splines of order <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/> are defined by</p>
<div class="math">
<p><img src="_images/math/25f41776edc960f5d83c76e5b2940375098e82a0.png" alt="B_{i,1}(x) &amp;=
  \left\{
    \begin{array}{cc}
      1, &amp; t_i \le x &lt; t_{i+1} \\
      0, &amp; \textrm{else}
    \end{array}
  \right. \\
B_{i,k}(x) &amp;= {(x - t_i) \over (t_{i+k-1} - t_i)} B_{i,k-1}(x) +
              {(t_{i+k} - x) \over (t_{i+k} - t_{i+1})} B_{i+1,k-1}(x)"/></p>
</div><p>for <img class="math" src="_images/math/0dc3924c3aa9c7ae7799d5719026a06511524a15.png" alt="i = 1, \ldots, n"/>. The common case of cubic B-splines
is given by <img class="math" src="_images/math/d04fe653b8e542bb615b615b9365f98744d2557d.png" alt="k = 4"/>. The above recurrence relation can be
evaluated in a numerically stable way by the de Boor algorithm.</p>
<p>In what follows, we will drop the <img class="math" src="_images/math/b6299704b700d9d4a7ba17e0c3f8bf4d4d03e43b.png" alt="\mathbf{t}"/> and simply refer
to the spline functions as <img class="math" src="_images/math/affcac78cbf3ede97b9d3996b222aff08b185b08.png" alt="f(x)"/> and <img class="math" src="_images/math/036a9d66203d7270f8b6efa0c9dd8f1248226185.png" alt="B_{i,k}(x)"/> for simplicity,
with the understanding that each set of spline basis functions depends on
the chosen knot vector <img class="math" src="_images/math/b6299704b700d9d4a7ba17e0c3f8bf4d4d03e43b.png" alt="\mathbf{t}"/>. We will also occasionally
drop the order <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/> and use <img class="math" src="_images/math/1109bb91dac7054e65c116fbd83887ffe28aaec4.png" alt="B_i(x)"/> and <img class="math" src="_images/math/036a9d66203d7270f8b6efa0c9dd8f1248226185.png" alt="B_{i,k}(x)"/>
interchangeably.</p>
<div class="section" id="vector-splines">
<h3>Vector Splines<a class="headerlink" href="#vector-splines" title="Permalink to this heading">¶</a></h3>
<p>The spline above can be generalized to vector control points,</p>
<div class="math">
<p><img src="_images/math/0dfd2a8ebaa6e1e40b5bce7bb1c6b5f7d47fd695.png" alt="\mathbf{f}(x) = \sum_{i=1}^n \mathbf{c}_i B_{i,k}(x)"/></p>
</div><p>where the <img class="math" src="_images/math/d3e2bef12fe8309eb869dcb6bfce1375f33b820f.png" alt="\mathbf{c}_i"/> may have some length <img class="math" src="_images/math/d8aab746990b1e68a457b5fa326f991469488b82.png" alt="m"/>.</p>
</div>
<div class="section" id="knot-vector">
<span id="index-2"></span><h3>Knot vector<a class="headerlink" href="#knot-vector" title="Permalink to this heading">¶</a></h3>
<p>In practice, one will often identify locations inside the interval
<img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/> where it makes sense to end one polynomial piece and
begin another. These locations are called <em>interior knots</em> or <em>breakpoints</em>.
It may be desirable to increase the density of knots in regions with rapid
changes, and decrease the density when the underlying data is changing slowly.
For some applications it may be simply best to distribute the knots with
equal spacing on the interval, which are called <em>uniform knots</em>.</p>
<p>The full knot vector will look like</p>
<div class="math">
<p><img src="_images/math/ec375e899759e48f88b462e14914ee58668c1682.png" alt="\mathbf{t} = \{ \underbrace{t_1, \dots, t_{k-1}}_{k-1}, \underbrace{t_k, \dots, t_{n+1},}_{n-k+2 \textrm{ interior knots}} \underbrace{t_{n+2}, \dots, t_{n+k}}_{k-1} \}"/></p>
</div><p>The <img class="math" src="_images/math/60aca4aeb1e96ddca6747b64383320f81ba2ec97.png" alt="n-k+2"/> interior knots are in <img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/>. In order to have a full
basis of B-splines, we require an additional <img class="math" src="_images/math/dc6dad7c2be06a2f58d2a5909e03d95923dd35fb.png" alt="2(k-1)"/> <em>exterior knots</em>,
<img class="math" src="_images/math/c30e2c27ad43f9176c532560a6fdadf8cf8dbb3f.png" alt="\{ t_1,\dots,t_{k-1}\}"/> and <img class="math" src="_images/math/3d0c93f0de9d49fd34f6c3d8da72218a4282211c.png" alt="\{ t_{n+2},\dots,t_{n+k}\}"/>.
These knots must satisfy</p>
<div class="math">
<p><img src="_images/math/2a5e377865d832725e0ebed1186e5d6611a93b66.png" alt="t_1 &amp; \le \cdots \le t_{k-1} = a \\
b &amp;= t_{n+2} \le \cdots \le t_{n+k}"/></p>
</div><p>but can otherwise be arbitrary.</p>
</div>
</div>
<div class="section" id="allocation-of-b-splines">
<span id="index-3"></span><h2>Allocation of B-splines<a class="headerlink" href="#allocation-of-b-splines" title="Permalink to this heading">¶</a></h2>
<dl class="c type">
<dt class="sig sig-object c" id="c.gsl_bspline_workspace">
<span class="k"><span class="pre">type</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></span><a class="headerlink" href="#c.gsl_bspline_workspace" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>The computation of B-spline functions requires a preallocated workspace.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_alloc">
<a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_alloc</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">k</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nbreak</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_alloc" title="Permalink to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.gsl_bspline_alloc_ncontrol">
<a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_alloc_ncontrol</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">k</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">ncontrol</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_alloc_ncontrol" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>These functions allocate a workspace for computing B-splines of order
<a class="reference internal" href="#c.gsl_bspline_alloc_ncontrol" title="k"><code class="xref c c-data docutils literal notranslate"><span class="pre">k</span></code></a>. The number of breakpoints is given by <code class="xref c c-data docutils literal notranslate"><span class="pre">nbreak</span></code>. Alternatively,
the number of control points <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> may be specified in <a class="reference internal" href="#c.gsl_bspline_alloc_ncontrol" title="ncontrol"><code class="xref c c-data docutils literal notranslate"><span class="pre">ncontrol</span></code></a>.
The relationship is <img class="math" src="_images/math/68d0a477345c89abea72b7b6b51f9b962dadb748.png" alt="\textrm{nbreak} = n - k + 2"/>. Cubic B-splines
are specified by <img class="math" src="_images/math/d04fe653b8e542bb615b615b9365f98744d2557d.png" alt="k = 4"/>. The size of the workspace is
<img class="math" src="_images/math/b7739dd5748aa87fdf7b360ab0af81832b85dc48.png" alt="O(2k^2 + 5k + \textrm{nbreak})"/>.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_free">
<span class="kt"><span class="pre">void</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_free</span></span></span><span class="sig-paren">(</span><a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_free" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function frees the memory associated with the workspace <a class="reference internal" href="#c.gsl_bspline_free" title="w"><code class="xref c c-data docutils literal notranslate"><span class="pre">w</span></code></a>.</p>
</dd></dl>

</div>
<div class="section" id="initializing-the-knots-vector">
<span id="index-4"></span><h2>Initializing the knots vector<a class="headerlink" href="#initializing-the-knots-vector" title="Permalink to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_init_augment">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_init_augment</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">tau</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_init_augment" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function initializes the knot vector <img class="math" src="_images/math/b6299704b700d9d4a7ba17e0c3f8bf4d4d03e43b.png" alt="\mathbf{t}"/> using the
non-decreasing interior knot vector <a class="reference internal" href="#c.gsl_bspline_init_augment" title="tau"><code class="xref c c-data docutils literal notranslate"><span class="pre">tau</span></code></a> of length <img class="math" src="_images/math/f7ae0ab0ddc358c8926c47094c6869ac3d1b9ec7.png" alt="n - k + 2"/> by
choosing the exterior knots to be equal to the first and last interior knot.
The total knot vector is</p>
<div class="math">
<p><img src="_images/math/7326b95de66b33f9ef447f97b5da03c87ff943b7.png" alt="\mathbf{t} = \{ \underbrace{\tau_1, \dots, \tau_1}_{k-1 \textrm{ copies}}, \tau_1, \tau_2, \dots, \tau_{n-k+2}, \underbrace{\tau_{n-k+2}, \dots, \tau_{n-k+2}}_{k-1 \textrm{ copies}} \}"/></p>
</div><p>where <img class="math" src="_images/math/7037cbecad4daa4e1a0db14f742486b49572b93c.png" alt="\tau_i"/> is specified by the <img class="math" src="_images/math/8ba3c887c6b69d4f3fc99ada2119799a385a325f.png" alt="i"/>-th element of <a class="reference internal" href="#c.gsl_bspline_init_augment" title="tau"><code class="xref c c-data docutils literal notranslate"><span class="pre">tau</span></code></a>.</p>
<p>This function does not verify that the <a class="reference internal" href="#c.gsl_bspline_init_augment" title="tau"><code class="xref c c-data docutils literal notranslate"><span class="pre">tau</span></code></a> vector is non-decreasing, so
the user must ensure this.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_init_uniform">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_init_uniform</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">a</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">b</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_init_uniform" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function constructs a knot vector using uniformly spaced interior knots on <img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/> and
sets the exterior knots to the interval endpoints.
The total knot vector is</p>
<div class="math">
<p><img src="_images/math/256223e638269af453ef30bb1603a92cc75ac934.png" alt="\mathbf{t} = \{ \underbrace{a, \dots, a}_{k-1 \textrm{ copies}}, \tau_1, \tau_2, \dots, \tau_{n-k+2}, \underbrace{b, \dots, b}_{k-1 \textrm{ copies}} \}"/></p>
</div><p>with</p>
<div class="math">
<p><img src="_images/math/782857da1e651131f8f7c857a7683bd54f0cfa36.png" alt="\tau_i = a + \frac{i-1}{n-k+1} (b-a), \qquad i = 1, \cdots, n-k+2"/></p>
</div></dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_init_periodic">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_init_periodic</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">a</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">b</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_init_periodic" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function constructs a knot vector suitable for defining a periodic B-spline on <img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/>
with a period <img class="math" src="_images/math/743173dc3e55cd3908bbef018e44bdb8ef88d047.png" alt="P = b - a"/>. There are several ways to choose a periodic knot vector.
Here, we adopt the approach of Dierckx, 1982, and require</p>
<div class="math">
<p><img src="_images/math/8198e425c83f3a3d3b15ace9db01ca487e75635e.png" alt="\begin{array}{ll}
  t_i = t_{i + n - k + 1} - P, &amp; i = 1, \dots, k-1 \\
  t_{n-k+1+i} = t_i + P, &amp; i = k+1, \dots, 2k-1
\end{array}"/></p>
</div><p>We further define a uniform spacing between each consecutive knot pair. The knot values are
given by</p>
<div class="math">
<p><img src="_images/math/3bd1a616e7c23549717d99a7458552e02d3eecb8.png" alt="t_i = \frac{i-k}{n-k+1} (b-a) + a, \qquad i = 1, \dots, n+k"/></p>
</div></dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_init_interp">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_init_interp</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_init_interp" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function calculates a knot vector suitable for interpolating data at the
<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> abscissa values provided in <a class="reference internal" href="#c.gsl_bspline_init_interp" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>, which must be in ascending order.
The knot vector for interpolation must satisfy the <em>Schoenberg-Whitney</em> conditions,</p>
<div class="math">
<p><img src="_images/math/af5cd287eab00cf4f2fad52cd50b15561f8a6ac6.png" alt="t_i &lt; x_i &lt; t_{i+k}, \quad i = 1, \dots, n"/></p>
</div><p>This function selects the knots according to</p>
<div class="math">
<p><img src="_images/math/8d5436766246231a6a62e7e6e6db87125adc167a.png" alt="t_i = \left\{
        \begin{array}{ll}
          x_1 &amp; i=1,\dots,k \\
          \frac{1}{k-1} \sum_{j=i-k+1}^{i-1} x_j &amp; i=k+1,\dots,n \\
          x_n &amp; i=n+1,\dots,n+k
        \end{array}
      \right."/></p>
</div><p>which satisfy the Schoenberg-Whitney conditions, although this may not be
the optimal knot vector for a given interpolation problem.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_init_hermite">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_init_hermite</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nderiv</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_init_hermite" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function calculates a knot vector suitable for performing Hermite
interpolation data at the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> abscissa values provided in <a class="reference internal" href="#c.gsl_bspline_init_hermite" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>,
which must be in ascending order. The parameter <a class="reference internal" href="#c.gsl_bspline_init_hermite" title="nderiv"><code class="xref c c-data docutils literal notranslate"><span class="pre">nderiv</span></code></a> specifies
the maximum derivative order which will be interpolated.</p>
<p>The knot vector has length <img class="math" src="_images/math/324b7b14a85be29269e267d796fa72e3c0e9f11d.png" alt="(m+1)(n+2)"/>, where <img class="math" src="_images/math/4d032e51463fea832c4cd08f8192006f9c36d3c6.png" alt="m = nderiv"/>, and is given by,</p>
<div class="math">
<p><img src="_images/math/defa591ad8f59b3fca1e7caf26035d2e1fb5a32c.png" alt="\mathbf{t} = \{ \underbrace{x_0, \dots, x_0}_{m+1 \textrm{ copies}}, \underbrace{x_1, \dots, x_1}_{m+1}, \dots, \underbrace{x_n, \dots, x_n}_{m+1}, \underbrace{x_{n+1}, \dots, x_{n+1}}_{m+1} \}"/></p>
</div><p>This function uses the convention that <img class="math" src="_images/math/bf0b4f7375b7225abc04d7ef57bd8a176b335ff2.png" alt="x_0 = x_1"/> and <img class="math" src="_images/math/809f03489adc88398b9b9bf188fe18d6dcf84a4f.png" alt="x_{n+1} = x_n"/>. See
Mummy (1989) for more details.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_init">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_init</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">t</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_init" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function sets the knot vector equal to the user-supplied vector <a class="reference internal" href="#c.gsl_bspline_init" title="t"><code class="xref c c-data docutils literal notranslate"><span class="pre">t</span></code></a> which
must have length <img class="math" src="_images/math/06750a6a5b5cf32161ca016ff14b089cc228d839.png" alt="n+k"/> and be non-decreasing.</p>
</dd></dl>

</div>
<div class="section" id="properties-of-b-splines">
<span id="index-5"></span><h2>Properties of B-splines<a class="headerlink" href="#properties-of-b-splines" title="Permalink to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_ncontrol">
<span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_ncontrol</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_ncontrol" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function returns the number of B-spline control points given by
<img class="math" src="_images/math/64de9dffe02286f18e21fbdd0a927c4155c475cc.png" alt="n = \textrm{nbreak} + k - 2"/>.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_order">
<span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_order</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_order" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function returns the B-spline order <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_nbreak">
<span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_nbreak</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_nbreak" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function returns the number of breakpoints (interior knots) defined for the B-spline.</p>
</dd></dl>

</div>
<div class="section" id="evaluation-of-b-splines">
<span id="index-6"></span><h2>Evaluation of B-splines<a class="headerlink" href="#evaluation-of-b-splines" title="Permalink to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_calc">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_calc</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">result</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_calc" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function evaluates the B-spline</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/2ef42ab14ca0689cfae6c3dc9c204b4702be2d9e.png" alt="f(x) = \sum_{i=1}^n c_i B_i(x)"/></p>
</div></div></blockquote>
<p>at the point <a class="reference internal" href="#c.gsl_bspline_calc" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> given the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> control points <a class="reference internal" href="#c.gsl_bspline_calc" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a>. The
result <img class="math" src="_images/math/affcac78cbf3ede97b9d3996b222aff08b185b08.png" alt="f(x)"/> is stored in <a class="reference internal" href="#c.gsl_bspline_calc" title="result"><code class="xref c c-data docutils literal notranslate"><span class="pre">result</span></code></a>.
If <a class="reference internal" href="#c.gsl_bspline_calc" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> lies outside the knot interval, a Taylor series approximation about the closest
knot endpoint is used to extrapolate the spline.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_vector_calc">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_vector_calc</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">result</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_vector_calc" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function evaluates the vector valued B-spline</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/971bc5dc8a5db84c593ed612514863713e4105fc.png" alt="\mathbf{f}(x) = \sum_{i=1}^n \mathbf{c}_i B_i(x)"/></p>
</div></div></blockquote>
<p>at the point <a class="reference internal" href="#c.gsl_bspline_vector_calc" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> given the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> control vectors <img class="math" src="_images/math/d3e2bef12fe8309eb869dcb6bfce1375f33b820f.png" alt="\mathbf{c}_i"/>.
The vector <img class="math" src="_images/math/d3e2bef12fe8309eb869dcb6bfce1375f33b820f.png" alt="\mathbf{c}_i"/> is stored in the <img class="math" src="_images/math/8ba3c887c6b69d4f3fc99ada2119799a385a325f.png" alt="i"/>-th column of <a class="reference internal" href="#c.gsl_bspline_vector_calc" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a>.
The result <img class="math" src="_images/math/cccfcf2238e2fbf2c518df20f31f83b58106b300.png" alt="\mathbf{f}(x)"/> is stored in <a class="reference internal" href="#c.gsl_bspline_vector_calc" title="result"><code class="xref c c-data docutils literal notranslate"><span class="pre">result</span></code></a>. The parameters
<a class="reference internal" href="#c.gsl_bspline_vector_calc" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a> and <a class="reference internal" href="#c.gsl_bspline_vector_calc" title="result"><code class="xref c c-data docutils literal notranslate"><span class="pre">result</span></code></a> must have the same number of rows.
If <a class="reference internal" href="#c.gsl_bspline_vector_calc" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> lies outside the knot interval, a Taylor series approximation about the closest
knot endpoint is used to extrapolate the spline.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_basis">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_basis</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">x</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">B</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">istart</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_basis" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function evaluates all potentially nonzero B-spline basis
functions at the position <a class="reference internal" href="#c.gsl_bspline_basis" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> and stores them in the vector <a class="reference internal" href="#c.gsl_bspline_basis" title="B"><code class="xref c c-data docutils literal notranslate"><span class="pre">B</span></code></a> of length
<img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>, so that the <img class="math" src="_images/math/8ba3c887c6b69d4f3fc99ada2119799a385a325f.png" alt="i"/>-th element is <img class="math" src="_images/math/e20d81ac8b06ababfd3dd6262d424775dd4580e2.png" alt="B_{(istart+i)}(x)"/> for
<img class="math" src="_images/math/39e5b7b63fb466809d100402b3ca65d329cc0dce.png" alt="i=0,1,\dots,k-1"/>. The output <a class="reference internal" href="#c.gsl_bspline_basis" title="istart"><code class="xref c c-data docutils literal notranslate"><span class="pre">istart</span></code></a> is guaranteed to be in
<img class="math" src="_images/math/2b3dc1346098620d135009c9f3e18f613a19009d.png" alt="[0, n - k]"/>.
By returning only the nonzero basis functions, this function
allows quantities involving linear combinations of the <img class="math" src="_images/math/1109bb91dac7054e65c116fbd83887ffe28aaec4.png" alt="B_i(x)"/>
to be computed without unnecessary terms
(such linear combinations occur, for example,
when evaluating an interpolated function).</p>
</dd></dl>

</div>
<div class="section" id="evaluation-of-b-spline-derivatives">
<span id="index-7"></span><h2>Evaluation of B-spline derivatives<a class="headerlink" href="#evaluation-of-b-spline-derivatives" title="Permalink to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_calc_deriv">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_calc_deriv</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nderiv</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">result</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_calc_deriv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function evaluates the B-spline derivative</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/3297dd00d00b525f67b51e0b0dd60f0b8bbcd719.png" alt="\frac{d^j}{dx^j} f(x) = \sum_{i=1}^n c_i \frac{d^j}{dx^j} B_i(x)"/></p>
</div></div></blockquote>
<p>at the point <a class="reference internal" href="#c.gsl_bspline_calc_deriv" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> given the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> control points <a class="reference internal" href="#c.gsl_bspline_calc_deriv" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a>. The derivative
order <img class="math" src="_images/math/247a8ccf6f990a64b94856540b903c7d1e5eef57.png" alt="j"/> is specified by <a class="reference internal" href="#c.gsl_bspline_calc_deriv" title="nderiv"><code class="xref c c-data docutils literal notranslate"><span class="pre">nderiv</span></code></a>. The result
<img class="math" src="_images/math/3cfa7cf3a984a22048576ce6f8870392baa2f905.png" alt="d^j f(x) / dx^j"/> is stored in <a class="reference internal" href="#c.gsl_bspline_calc_deriv" title="result"><code class="xref c c-data docutils literal notranslate"><span class="pre">result</span></code></a>.
If <a class="reference internal" href="#c.gsl_bspline_calc_deriv" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> lies outside the knot interval, a Taylor series approximation about the closest
knot endpoint is used to extrapolate the spline.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_vector_calc_deriv">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_vector_calc_deriv</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nderiv</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">result</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_vector_calc_deriv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function evaluates the vector valued B-spline derivative</p>
<blockquote>
<div><div class="math">
<p><img src="_images/math/deb203e38e7d44a65b634d6cfc7f6cd606992dc2.png" alt="\frac{d^j}{dx^j} \mathbf{f}(x) = \sum_{i=1}^n \mathbf{c}_i \frac{d^j}{dx^j} B_i(x)"/></p>
</div></div></blockquote>
<p>at the point <a class="reference internal" href="#c.gsl_bspline_vector_calc_deriv" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> given the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> control vectors <img class="math" src="_images/math/d3e2bef12fe8309eb869dcb6bfce1375f33b820f.png" alt="\mathbf{c}_i"/>.
The vector <img class="math" src="_images/math/d3e2bef12fe8309eb869dcb6bfce1375f33b820f.png" alt="\mathbf{c}_i"/> is stored in the <img class="math" src="_images/math/8ba3c887c6b69d4f3fc99ada2119799a385a325f.png" alt="i"/>-th column of <a class="reference internal" href="#c.gsl_bspline_vector_calc_deriv" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a>.
The result <img class="math" src="_images/math/3e6ac69227148884288741e42ab445f39c91965f.png" alt="d^j \mathbf{f}(x) / dx^j"/> is stored in <a class="reference internal" href="#c.gsl_bspline_vector_calc_deriv" title="result"><code class="xref c c-data docutils literal notranslate"><span class="pre">result</span></code></a>. The parameters
<a class="reference internal" href="#c.gsl_bspline_vector_calc_deriv" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a> and <a class="reference internal" href="#c.gsl_bspline_vector_calc_deriv" title="result"><code class="xref c c-data docutils literal notranslate"><span class="pre">result</span></code></a> must have the same number of rows. The derivative
order <img class="math" src="_images/math/247a8ccf6f990a64b94856540b903c7d1e5eef57.png" alt="j"/> is specified in <a class="reference internal" href="#c.gsl_bspline_vector_calc_deriv" title="nderiv"><code class="xref c c-data docutils literal notranslate"><span class="pre">nderiv</span></code></a>.
If <a class="reference internal" href="#c.gsl_bspline_vector_calc_deriv" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> lies outside the knot interval, a Taylor series approximation about the closest
knot endpoint is used to extrapolate the spline.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_basis_deriv">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_basis_deriv</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nderiv</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dB</span></span>, <span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">istart</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_basis_deriv" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function evaluates all potentially nonzero B-spline basis function
derivatives of orders <img class="math" src="_images/math/77bfa83830305fac291e4e73b780e4cc9458b293.png" alt="0"/> through <a class="reference internal" href="#c.gsl_bspline_basis_deriv" title="nderiv"><code class="xref c c-data docutils literal notranslate"><span class="pre">nderiv</span></code></a> (inclusive) at
the position <a class="reference internal" href="#c.gsl_bspline_basis_deriv" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> and stores them in the matrix <a class="reference internal" href="#c.gsl_bspline_basis_deriv" title="dB"><code class="xref c c-data docutils literal notranslate"><span class="pre">dB</span></code></a>.  The
<img class="math" src="_images/math/92807ade5bf57ca25e8e9ad6a1d3169b9081d66d.png" alt="(i,j)"/>-th element of <a class="reference internal" href="#c.gsl_bspline_basis_deriv" title="dB"><code class="xref c c-data docutils literal notranslate"><span class="pre">dB</span></code></a> is <img class="math" src="_images/math/7e28584c4e9efa275ae513fef4c032f143a57400.png" alt="d^jB_{(istart+i)}(x)/dx^j"/>.
The last row of <a class="reference internal" href="#c.gsl_bspline_basis_deriv" title="dB"><code class="xref c c-data docutils literal notranslate"><span class="pre">dB</span></code></a> contains <img class="math" src="_images/math/1fad08f9e5b267335e80ef333109da291ee5e34c.png" alt="d^jB_{istart+k-1}(x)/dx^j"/>.
The matrix <a class="reference internal" href="#c.gsl_bspline_basis_deriv" title="dB"><code class="xref c c-data docutils literal notranslate"><span class="pre">dB</span></code></a> must be
of size <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/> by at least <img class="math" src="_images/math/08bac0d55d43459ffac0c148e9ba0d2c623c2a4f.png" alt="nderiv + 1"/>.
The output <a class="reference internal" href="#c.gsl_bspline_basis_deriv" title="istart"><code class="xref c c-data docutils literal notranslate"><span class="pre">istart</span></code></a> is guaranteed to be in <img class="math" src="_images/math/2b3dc1346098620d135009c9f3e18f613a19009d.png" alt="[0, n - k]"/>.
Note that function evaluations are included as the zeroth order derivatives in <a class="reference internal" href="#c.gsl_bspline_basis_deriv" title="dB"><code class="xref c c-data docutils literal notranslate"><span class="pre">dB</span></code></a>.
By returning only the nonzero basis functions, this function allows
quantities involving linear combinations of the <img class="math" src="_images/math/1109bb91dac7054e65c116fbd83887ffe28aaec4.png" alt="B_i(x)"/> and
their derivatives to be computed without unnecessary terms.</p>
</dd></dl>

</div>
<div class="section" id="evaluation-of-b-spline-integrals">
<span id="index-8"></span><h2>Evaluation of B-spline integrals<a class="headerlink" href="#evaluation-of-b-spline-integrals" title="Permalink to this heading">¶</a></h2>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_calc_integ">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_calc_integ</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">a</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">b</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">result</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_calc_integ" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function computes the integral</p>
<div class="math">
<p><img src="_images/math/c9c61639410bdb2b20d06234b19e68aff1d0c5be.png" alt="\int_a^b f(x) dx = \sum_{i=1}^n c_i \int_a^b B_i(x) dx"/></p>
</div><p>using the coefficients stored in <a class="reference internal" href="#c.gsl_bspline_calc_integ" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a> and the integration limits
(<a class="reference internal" href="#c.gsl_bspline_calc_integ" title="a"><code class="xref c c-data docutils literal notranslate"><span class="pre">a</span></code></a>, <a class="reference internal" href="#c.gsl_bspline_calc_integ" title="b"><code class="xref c c-data docutils literal notranslate"><span class="pre">b</span></code></a>). The integral value is stored in <a class="reference internal" href="#c.gsl_bspline_calc_integ" title="result"><code class="xref c c-data docutils literal notranslate"><span class="pre">result</span></code></a>
on output.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_basis_integ">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_basis_integ</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">a</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">b</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_basis_integ" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function computes the integral from <a class="reference internal" href="#c.gsl_bspline_basis_integ" title="a"><code class="xref c c-data docutils literal notranslate"><span class="pre">a</span></code></a> to <a class="reference internal" href="#c.gsl_bspline_basis_integ" title="b"><code class="xref c c-data docutils literal notranslate"><span class="pre">b</span></code></a> of each
basis function <img class="math" src="_images/math/1109bb91dac7054e65c116fbd83887ffe28aaec4.png" alt="B_i(x)"/>,</p>
<div class="math">
<p><img src="_images/math/ae6b8b422359cbba07eb80d47727f00c53f8520a.png" alt="y_i = \int_a^b B_i(x) dx"/></p>
</div><p>storing the results in the vector <a class="reference internal" href="#c.gsl_bspline_basis_integ" title="y"><code class="xref c c-data docutils literal notranslate"><span class="pre">y</span></code></a>, of length <code class="code docutils literal notranslate"><span class="pre">ncontrol</span></code>.
The algorithm uses Gauss-Legendre quadrature on each knot interval.</p>
</dd></dl>

</div>
<div class="section" id="least-squares-fitting-with-b-splines">
<span id="index-9"></span><h2>Least Squares Fitting with B-splines<a class="headerlink" href="#least-squares-fitting-with-b-splines" title="Permalink to this heading">¶</a></h2>
<p>A common application is to fit a B-spline to a set of <img class="math" src="_images/math/d8aab746990b1e68a457b5fa326f991469488b82.png" alt="m"/> data
points <img class="math" src="_images/math/3cac6a62c3ca5ddb61cce70f724a9d49a7e399d0.png" alt="(x_i,y_i)"/> without requiring the spline to pass through
each point, but rather the spline fits the data in a least square sense.
In this case, the number of control points can be much less than <img class="math" src="_images/math/d8aab746990b1e68a457b5fa326f991469488b82.png" alt="m"/>
and the result is a smooth spline which minimizes the cost function,</p>
<div class="math">
<p><img src="_images/math/ae21de27d9fca415bddaae4c91a70840c2ef70f5.png" alt="\chi^2 = \sum_{i=1}^m w_i \left( y_i - f(x_i) \right)^2 = || y - X c ||_W^2"/></p>
</div><p>where <img class="math" src="_images/math/e807ba9c0478cbe6b0900d22f7e07228d5f40f89.png" alt="f(x) = \sum_{j=1}^n c_j B_{j,k}(x)"/> is the B-spline defined above,
<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> is the number of control points for the spline, <img class="math" src="_images/math/3ce566c35b87c5af4a91d305869e199410879e25.png" alt="W = \textrm{diag}(w)"/>, and
<img class="math" src="_images/math/3c8d77eda2fce9241195c999d39bd792e652c7e8.png" alt="X_{ij} = B_{j,k}(x_i)"/> is the least squares design matrix. The parameters
<img class="math" src="_images/math/ece130da0e1e9c9e66b0053903b5cffae6299256.png" alt="w_i"/> are optional weights which can be assigned to
each data point <img class="math" src="_images/math/3cac6a62c3ca5ddb61cce70f724a9d49a7e399d0.png" alt="(x_i,y_i)"/>. Because each basis spline <img class="math" src="_images/math/807dc3d9a819d09efcf5d0ed1ef380c276baf766.png" alt="B_{j,k}(x)"/>
has local support <img class="math" src="_images/math/d545218f54018414c8b9d0919de489e2ad4ab0f9.png" alt="(B_{j,k}(x) = 0"/> for <img class="math" src="_images/math/3aff24786952148555ab9906eb04bbb9fc63d136.png" alt="x \notin \left[ t_j,\dots,t_{j+k} \right])"/>,
the least squares design matrix <img class="math" src="_images/math/a5ff3717ce7e8e5b109e09a32e89321eef3862bf.png" alt="X"/> has only <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>
nonzero entries per row. Therefore, the normal equations matrix <img class="math" src="_images/math/644910dc4aee9f2d80872e6cd7dbf2a6a4a069d9.png" alt="X^T W X"/> is
<a class="reference internal" href="linalg.html#sec-symmetric-banded"><span class="std std-ref">symmetric and banded</span></a>, with lower bandwidth <img class="math" src="_images/math/f2a1956e91647c128c4dcf865b90a0ae4c09b08a.png" alt="k - 1"/>.
The GSL routines below use a banded Cholesky factorization to solve the normal
equations system for the unknown coefficient vector,</p>
<div class="math">
<p><img src="_images/math/84d516e94bc43fd6166b6fd57c29b30589cf509b.png" alt="c = \left( X^T W X \right)^{-1} X^T W y"/></p>
</div><p>The normal equations approach is often avoided in least squares problems, since
if <img class="math" src="_images/math/a5ff3717ce7e8e5b109e09a32e89321eef3862bf.png" alt="X"/> is badly conditioned, then <img class="math" src="_images/math/644910dc4aee9f2d80872e6cd7dbf2a6a4a069d9.png" alt="X^T W X"/> is much worse conditioned,
which can lead to loss of accuracy in the solution vector. However, a theorem
of de Boor [de Boor (2001), XI(4)] states that the condition number of the B-spline basis is independent
of the knot vector <img class="math" src="_images/math/b6299704b700d9d4a7ba17e0c3f8bf4d4d03e43b.png" alt="\mathbf{t}"/> and bounded, depending only on <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>.
Numerical evidence has shown that for reasonably small <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/> the normal
equations matrix is well conditioned, and a banded Cholesky factorization can
be used safely.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_lssolve">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_lssolve</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">chisq</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_lssolve" title="Permalink to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.gsl_bspline_wlssolve">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_wlssolve</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">wts</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">chisq</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_wlssolve" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>These functions fit a B-spline to the input data (<a class="reference internal" href="#c.gsl_bspline_wlssolve" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>, <a class="reference internal" href="#c.gsl_bspline_wlssolve" title="y"><code class="xref c c-data docutils literal notranslate"><span class="pre">y</span></code></a>) which must be
the same length <img class="math" src="_images/math/d8aab746990b1e68a457b5fa326f991469488b82.png" alt="m"/>. Optional weights may be given in the <a class="reference internal" href="#c.gsl_bspline_wlssolve" title="wts"><code class="xref c c-data docutils literal notranslate"><span class="pre">wts</span></code></a> vector. The
banded normal equations matrix is assembled and factored with a Cholesky factorization,
and then solved, storing the coefficients in the vector <a class="reference internal" href="#c.gsl_bspline_wlssolve" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a>, which has length
<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>. The cost function <img class="math" src="_images/math/01819910bb5ba61b86a3f7905f11513051954f42.png" alt="\chi^2"/> is output in <a class="reference internal" href="#c.gsl_bspline_wlssolve" title="chisq"><code class="xref c c-data docutils literal notranslate"><span class="pre">chisq</span></code></a>. If the normal equations matrix
is singular, the error code <a class="reference internal" href="err.html#c.GSL_EDOM" title="GSL_EDOM"><code class="xref c c-macro docutils literal notranslate"><span class="pre">GSL_EDOM</span></code></a> is returned. This could occur, for example,
if there is a large gap in the data vectors so that no data points constrain a particular
<img class="math" src="_images/math/036a9d66203d7270f8b6efa0c9dd8f1248226185.png" alt="B_{i,k}(x)"/> basis function.</p>
<p>On output, <code class="code docutils literal notranslate"><span class="pre">w-&gt;XTX</span></code> contains the Cholesky factor of the symmetric banded normal equations
matrix, and this can be passed directly to the functions <a class="reference internal" href="#c.gsl_bspline_covariance" title="gsl_bspline_covariance"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_bspline_covariance()</span></code></a> and
<a class="reference internal" href="#c.gsl_bspline_rcond" title="gsl_bspline_rcond"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_bspline_rcond()</span></code></a>.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_lsnormal">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_lsnormal</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">wts</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">XTy</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">XTX</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_lsnormal" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function builds the normal equations matrix <img class="math" src="_images/math/644910dc4aee9f2d80872e6cd7dbf2a6a4a069d9.png" alt="X^T W X"/> and right hand side vector
<img class="math" src="_images/math/2618f8960dcee3eebd010f19fed5e9200088c294.png" alt="X^T W y"/>, which are stored in <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="XTX"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTX</span></code></a> and <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="XTy"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTy</span></code></a> on output. The diagonal
weight matrix <img class="math" src="_images/math/3e0a087f1ba0411943c6deb7302825e47c187635.png" alt="W"/> is specified by the input vector <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="wts"><code class="xref c c-data docutils literal notranslate"><span class="pre">wts</span></code></a>, which may be set
to <code class="code docutils literal notranslate"><span class="pre">NULL</span></code>, in which case <img class="math" src="_images/math/e37a23b6281e5453f4d3ed42c3deb0b047c37766.png" alt="W = I"/>. The inputs <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>, <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="y"><code class="xref c c-data docutils literal notranslate"><span class="pre">y</span></code></a>, and <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="wts"><code class="xref c c-data docutils literal notranslate"><span class="pre">wts</span></code></a>
represent the data and weights to be fitted in a least-squares sense, and they all have length
<img class="math" src="_images/math/d8aab746990b1e68a457b5fa326f991469488b82.png" alt="m"/>. While the full normal equations matrix has
dimension <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>, it has a significant number of zeros, and so the output
matrix <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="XTX"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTX</span></code></a> is stored in <a class="reference internal" href="linalg.html#sec-symmetric-banded"><span class="std std-ref">banded symmetric format</span></a>. Therefore,
its dimensions are <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>. The vector <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="XTy"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTy</span></code></a> has length <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>.
The output matrix <a class="reference internal" href="#c.gsl_bspline_lsnormal" title="XTX"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTX</span></code></a> can be passed directly into a banded Cholesky factorization
routine, such as <a class="reference internal" href="linalg.html#c.gsl_linalg_cholesky_band_decomp" title="gsl_linalg_cholesky_band_decomp"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_linalg_cholesky_band_decomp()</span></code></a>.</p>
<p>This function is normally called by <a class="reference internal" href="#c.gsl_bspline_wlssolve" title="gsl_bspline_wlssolve"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_bspline_wlssolve()</span></code></a> but is available for
users with more specialized applications.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_lsnormalm">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_lsnormalm</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">Y</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">wts</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">XTY</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">XTX</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_lsnormalm" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function builds the normal equations matrix <img class="math" src="_images/math/644910dc4aee9f2d80872e6cd7dbf2a6a4a069d9.png" alt="X^T W X"/> and right hand side vectors
<img class="math" src="_images/math/4f1afa08cff0669e252e8f667f8cbe3a2f517fb9.png" alt="X^T W Y"/>, which are stored in <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="XTX"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTX</span></code></a> and <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="XTY"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTY</span></code></a> on output. The diagonal
weight matrix <img class="math" src="_images/math/3e0a087f1ba0411943c6deb7302825e47c187635.png" alt="W"/> is specified by the input vector <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="wts"><code class="xref c c-data docutils literal notranslate"><span class="pre">wts</span></code></a>, which may be set
to <code class="code docutils literal notranslate"><span class="pre">NULL</span></code>, in which case <img class="math" src="_images/math/e37a23b6281e5453f4d3ed42c3deb0b047c37766.png" alt="W = I"/>. The input <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="Y"><code class="xref c c-data docutils literal notranslate"><span class="pre">Y</span></code></a> is a matrix of the
right hand side vectors, of size <img class="math" src="_images/math/d8aab746990b1e68a457b5fa326f991469488b82.png" alt="m"/>-by-nrhs. The inputs <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> and <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="wts"><code class="xref c c-data docutils literal notranslate"><span class="pre">wts</span></code></a>
represent the data and weights to be fitted in a least-squares sense, and they have length
<img class="math" src="_images/math/d8aab746990b1e68a457b5fa326f991469488b82.png" alt="m"/>. While the full normal equations matrix has
dimension <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>, it has a significant number of zeros, and so the output
matrix <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="XTX"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTX</span></code></a> is stored in <a class="reference internal" href="linalg.html#sec-symmetric-banded"><span class="std std-ref">banded symmetric format</span></a>. Therefore,
its dimensions are <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>. The matrix <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="XTY"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTY</span></code></a> has size <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-nrhs.
The output matrix <a class="reference internal" href="#c.gsl_bspline_lsnormalm" title="XTX"><code class="xref c c-data docutils literal notranslate"><span class="pre">XTX</span></code></a> can be passed directly into a banded Cholesky factorization
routine, such as <a class="reference internal" href="linalg.html#c.gsl_linalg_cholesky_band_decomp" title="gsl_linalg_cholesky_band_decomp"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_linalg_cholesky_band_decomp()</span></code></a>.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_residuals">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_residuals</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">r</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_residuals" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function computes the residual vector <img class="math" src="_images/math/d815202d57564a41c19d72a579db0830af9c527a.png" alt="r_i = y_i - f(x_i)"/> by
evaluating the spline <img class="math" src="_images/math/affcac78cbf3ede97b9d3996b222aff08b185b08.png" alt="f(x)"/> using the coefficients <a class="reference internal" href="#c.gsl_bspline_residuals" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a>.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_covariance">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_covariance</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cholesky</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cov</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_covariance" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function computes the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> covariance matrix
<img class="math" src="_images/math/c8625518c37f8acb1b7fcdaabc30ed89c6be378d.png" alt="\left( X^T W X \right)^{-1}"/> using the banded symmetric Cholesky decomposition
stored in <a class="reference internal" href="#c.gsl_bspline_covariance" title="cholesky"><code class="xref c c-data docutils literal notranslate"><span class="pre">cholesky</span></code></a>, which has dimensions <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>.
The output is stored in <a class="reference internal" href="#c.gsl_bspline_covariance" title="cov"><code class="xref c c-data docutils literal notranslate"><span class="pre">cov</span></code></a>. The function <a class="reference internal" href="linalg.html#c.gsl_linalg_cholesky_band_decomp" title="gsl_linalg_cholesky_band_decomp"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_linalg_cholesky_band_decomp()</span></code></a>
must be called on the normal equations matrix to compute the Cholesky factor
prior to calling this function.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_err">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_err</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nderiv</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">cov</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">err</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_err" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function computes the standard deviation error of a spline (or its derivative),</p>
<div class="math">
<p><img src="_images/math/54c2b3e8cc346a0b157ef3115c08d6d1823c5731.png" alt="f^{(q)}(x) = \sum_{j=1}^n c_j B^{(q)}_j(x)"/></p>
</div><p>at the point <a class="reference internal" href="#c.gsl_bspline_err" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> using the covariance matrix <a class="reference internal" href="#c.gsl_bspline_err" title="cov"><code class="xref c c-data docutils literal notranslate"><span class="pre">cov</span></code></a> calculated previously with
<a class="reference internal" href="#c.gsl_bspline_covariance" title="gsl_bspline_covariance"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_bspline_covariance()</span></code></a>. The derivative order is specified by <a class="reference internal" href="#c.gsl_bspline_err" title="nderiv"><code class="xref c c-data docutils literal notranslate"><span class="pre">nderiv</span></code></a>. The
error is stored in <a class="reference internal" href="#c.gsl_bspline_err" title="err"><code class="xref c c-data docutils literal notranslate"><span class="pre">err</span></code></a> on output, which is defined as,</p>
<div class="math">
<p><img src="_images/math/06b59cdc1c914cbd3d1da9cd514310312b0bed78.png" alt="\delta f = \sqrt{\mathbf{B}^{(q)}(x)^T C \mathbf{B}^{(q)}(x)}"/></p>
</div><p>where <img class="math" src="_images/math/0b330bc3b2b90c6a370cf211fd2fe1db135870d7.png" alt="\mathbf{B}^{(q)}(x) = \left( B_1^{(q)}(x), \dots, B_n^{(q)}(x) \right)"/> is
the vector of B-spline values evaluated at <img class="math" src="_images/math/43f98bc915444c1fdc19b396ac4fbc66f194c578.png" alt="x"/>, and <img class="math" src="_images/math/1c7cd1082f784807490782bc79aaad2511a89f8b.png" alt="C"/> is the covariance matrix.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_rcond">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_rcond</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">XTX</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rcond</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_rcond" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function estimates the reciprocal condition number (using the 1-norm) of the normal
equations matrix <img class="math" src="_images/math/644910dc4aee9f2d80872e6cd7dbf2a6a4a069d9.png" alt="X^T W X"/>, using its Cholesky decomposition, which must be
computed previously by calling <a class="reference internal" href="linalg.html#c.gsl_linalg_cholesky_band_decomp" title="gsl_linalg_cholesky_band_decomp"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_linalg_cholesky_band_decomp()</span></code></a>.
The reciprocal condition number estimate, defined as
<img class="math" src="_images/math/060c098948b336a1ca5e025938b4754428e738e4.png" alt="1 / (||X^T W X||_1 \cdot ||(X^T W X)^{-1}||_1)"/>, is stored in <a class="reference internal" href="#c.gsl_bspline_rcond" title="rcond"><code class="xref c c-data docutils literal notranslate"><span class="pre">rcond</span></code></a> on output.</p>
</dd></dl>

<div class="section" id="periodic-spline-fitting">
<h3>Periodic Spline Fitting<a class="headerlink" href="#periodic-spline-fitting" title="Permalink to this heading">¶</a></h3>
<p>Some applications require fitting a spline to a dataset which has an underlying
periodicity associated with it. In these cases it is desirable to construct a spline
which exhibits the same periodicity. A spline <img class="math" src="_images/math/affcac78cbf3ede97b9d3996b222aff08b185b08.png" alt="f(x)"/> is called periodic on
<img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/> if it satisfies the conditions</p>
<div class="math">
<p><img src="_images/math/6bc3256141a2db2d6c4e55640397411935530199.png" alt="f^{(j)}(a) = f^{(j)}(b), \qquad j = 0, \dots, k - 2"/></p>
</div><p>These conditions can be satisfied with the following constraints on the knot
vector and the control points (Dierckx, 1982),</p>
<div class="math">
<p><img src="_images/math/370c50c6eeaffc4ce0babf8af7b11dc2c27a4378.png" alt="t_i &amp;= t_{i + n - k + 1} - P, \qquad i = 1, \dots, k-1 \\
t_{n-k+1+i} &amp;= t_i + P, \qquad i = k+1, \dots, 2k-1 \\
c_i &amp;= c_{n - k + 1 + i}, \qquad i = 1, \dots, k - 1"/></p>
</div><p>where <img class="math" src="_images/math/743173dc3e55cd3908bbef018e44bdb8ef88d047.png" alt="P = b - a"/> is the period. The constraint on the control
points <img class="math" src="_images/math/8f3ed3aa23232b84b9d4f7e1d0068c62e5869384.png" alt="c_i"/> means that there are only <img class="math" src="_images/math/8871e0d53ebbe90182d90a506f3d55944a4b8b74.png" alt="n-k+1"/> independent
control points, and then the remaining <img class="math" src="_images/math/4c7ea67e12bcbba0d5be6a3914a0eb2d17ef2cd7.png" alt="k-1"/> are determined. The
independent control points <img class="math" src="_images/math/1f8630627a0e3a4cb8c3ad233dafe8653ba1c4db.png" alt="c^{*} = \{ c_1, \dots, c_{n-k+1} \}"/>
can be determined by solving the following least squares problem (Dierckx, 1982):</p>
<div class="math">
<p><img src="_images/math/e6c08e45049137c9a27b102c782eeef2cc32256b.png" alt="\min_{c^{*}} \left|\left| y - X^{*} c^{*} \right|\right|_W^2"/></p>
</div><p>where <img class="math" src="_images/math/3805a1bd6a24e587dc2add21a51935418fafd515.png" alt="X^{*}_{ij} = B^{*}_{j,k}(x_i)"/> and</p>
<div class="math">
<p><img src="_images/math/9a82a61f1515c4b54b3b3697d8f0e72740edda91.png" alt="B^{*}_{j,k}(x) = \left\{
  \begin{array}{ll}
    B_{j,k}(x) + B_{n-k+j+1,k}(x), &amp; j = 1, \dots, k-1 \\
    B_{j,k}(x), &amp; j = k, \dots, n-k+1
  \end{array}
\right."/></p>
</div><dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_plssolve">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_plssolve</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">chisq</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_plssolve" title="Permalink to this definition">¶</a><br /></dt>
<dt class="sig sig-object c" id="c.gsl_bspline_pwlssolve">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_pwlssolve</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">wts</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">chisq</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_pwlssolve" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>These functions fit a periodic B-spline to the input data (<a class="reference internal" href="#c.gsl_bspline_pwlssolve" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>, <a class="reference internal" href="#c.gsl_bspline_pwlssolve" title="y"><code class="xref c c-data docutils literal notranslate"><span class="pre">y</span></code></a>) which
must be the same length <img class="math" src="_images/math/d8aab746990b1e68a457b5fa326f991469488b82.png" alt="m"/>.  Optional weights may be given in the <a class="reference internal" href="#c.gsl_bspline_pwlssolve" title="wts"><code class="xref c c-data docutils literal notranslate"><span class="pre">wts</span></code></a> vector.
The input vector <a class="reference internal" href="#c.gsl_bspline_pwlssolve" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> must be sorted in ascending order, in order to efficiently
compute the <img class="math" src="_images/math/9a88d76d34a869b8551687422b5891ec9275e399.png" alt="QR"/> decomposition of the least squares system.
The algorithm computes the <img class="math" src="_images/math/9a88d76d34a869b8551687422b5891ec9275e399.png" alt="QR"/> decomposition of the least squares matrix,
one row at a time using Givens transformations, taking advantage of sparse structure
due to the local properties of the B-spline basis. On output, the coefficients are stored
in the vector <a class="reference internal" href="#c.gsl_bspline_pwlssolve" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a>, which has length <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>. The cost function
<img class="math" src="_images/math/d3efc4dc2dc3136ef098f9f0d869f6b3821d3017.png" alt="\chi^2 = || y - X c ||_W^2"/> is output in <a class="reference internal" href="#c.gsl_bspline_pwlssolve" title="chisq"><code class="xref c c-data docutils literal notranslate"><span class="pre">chisq</span></code></a>.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_plsqr">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_plsqr</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">wts</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">R</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">QTy</span></span>, <span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">rnorm</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_plsqr" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function calculates the <img class="math" src="_images/math/e7ab078b9051b4f8f0bad24ab0ac0f62ea8be575.png" alt="R"/> factor and <img class="math" src="_images/math/11b0fa39eed1e7b59c80a37ec4d5c1126dd6623a.png" alt="Q^T y"/> vector for a periodic
spline fitting problem on the input data (<a class="reference internal" href="#c.gsl_bspline_plsqr" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>, <a class="reference internal" href="#c.gsl_bspline_plsqr" title="y"><code class="xref c c-data docutils literal notranslate"><span class="pre">y</span></code></a>) with optional weights
<a class="reference internal" href="#c.gsl_bspline_plsqr" title="wts"><code class="xref c c-data docutils literal notranslate"><span class="pre">wts</span></code></a>. The input vector <a class="reference internal" href="#c.gsl_bspline_plsqr" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> must be sorted in ascending order.
On output, the <img class="math" src="_images/math/a0e966178ee3b750c19bc64dc7db5ae7ccb4677a.png" alt="(n-k+1)"/>-by-<img class="math" src="_images/math/a0e966178ee3b750c19bc64dc7db5ae7ccb4677a.png" alt="(n-k+1)"/> <img class="math" src="_images/math/e7ab078b9051b4f8f0bad24ab0ac0f62ea8be575.png" alt="R"/> factor is stored
in <a class="reference internal" href="#c.gsl_bspline_plsqr" title="R"><code class="xref c c-data docutils literal notranslate"><span class="pre">R</span></code></a>, while the first <img class="math" src="_images/math/8871e0d53ebbe90182d90a506f3d55944a4b8b74.png" alt="n-k+1"/> elements of the vector <img class="math" src="_images/math/11b0fa39eed1e7b59c80a37ec4d5c1126dd6623a.png" alt="Q^T y"/>
are stored in <a class="reference internal" href="#c.gsl_bspline_plsqr" title="QTy"><code class="xref c c-data docutils literal notranslate"><span class="pre">QTy</span></code></a>. The residual norm <img class="math" src="_images/math/3101ccc18acd612754494908fcab0c4f5810d894.png" alt="||y - X^{*} c^{*}||_W"/> is stored in <a class="reference internal" href="#c.gsl_bspline_plsqr" title="rnorm"><code class="xref c c-data docutils literal notranslate"><span class="pre">rnorm</span></code></a>.</p>
</dd></dl>

<span class="target" id="sec-bspline-gram"></span></div>
</div>
<div class="section" id="gram-matrix">
<span id="index-10"></span><h2>Gram Matrix<a class="headerlink" href="#gram-matrix" title="Permalink to this heading">¶</a></h2>
<p>Let <img class="math" src="_images/math/ab1c8a85f6d42a33e77429d13d481d421da05f8d.png" alt="\mathbf{B}(x) = (B_1(x), B_2(x), \dots, B_n(x))^T"/> be the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-vector whose
elements are the B-spline basis functions evaluated at <img class="math" src="_images/math/43f98bc915444c1fdc19b396ac4fbc66f194c578.png" alt="x"/>. Then
the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> <em>outer product matrix</em> of the B-spline basis at <img class="math" src="_images/math/43f98bc915444c1fdc19b396ac4fbc66f194c578.png" alt="x"/>
is defined as</p>
<div class="math">
<p><img src="_images/math/e64aa221814d1f72aa5288e36671dc1c49a7ffbe.png" alt="A(x) = \mathbf{B}(x) \otimes \mathbf{B}(x) = \mathbf{B}(x) \mathbf{B}(x)^T, \quad A_{ij}(x) = B_i(x) B_j(x)"/></p>
</div><p>This can be generalized to higher order derivatives,</p>
<div class="math">
<p><img src="_images/math/497ff97731892a839851bb371131f15c3cdb3df0.png" alt="A_{ij}^{(q)}(x) = \left( \frac{d^q}{dx^q} B_i(x) \right) \left( \frac{d^q}{dx^q} B_j(x) \right)"/></p>
</div><p>Then, the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> Gram matrix of the B-spline basis is defined as</p>
<div class="math">
<p><img src="_images/math/095c18de8b06b6042bff700e1f0a0b0e0cb19134.png" alt="G_{ij}^{(q)} = \int_a^b A_{ij}^{(q)}(x) dx = \int_a^b \left( \frac{d^q}{dx^q} B_i(x) \right) \left( \frac{d^q}{dx^q} B_j(x) \right) dx"/></p>
</div><p>where the integral is usually taken over the full support of the B-splines, i.e. from
<img class="math" src="_images/math/9513c600c9a60ad21d7a45472782d4818f77435d.png" alt="\min(\mathbf{t})"/> to <img class="math" src="_images/math/a3b7c6e62cc380a86190cbe3b51f3ed502d371ee.png" alt="\max(\mathbf{t})"/>. However it can be computed
over any interval <img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/>.</p>
<p>The B-spline outer product and Gram matrices are <a class="reference internal" href="linalg.html#sec-symmetric-banded"><span class="std std-ref">symmetric and banded</span></a> with lower bandwidth
<img class="math" src="_images/math/f2a1956e91647c128c4dcf865b90a0ae4c09b08a.png" alt="k - 1"/>. These matrices are positive semi-definite, and in the case of <img class="math" src="_images/math/330f2042ede9d5b2ef9b7d78d47a3fff4768a34b.png" alt="q = 0"/>,
<img class="math" src="_images/math/d08b1dfb5136e560239693368623d15489ec9d3f.png" alt="A^{(0)}"/> and <img class="math" src="_images/math/65d767aedde9f4b2c6bc99d4fbcbcd81c11a5f46.png" alt="G^{(0)}"/> are positive
definite. These matrices have applications in least-squares fitting.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_oprod">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_oprod</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nderiv</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">x</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">A</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_oprod" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function calculates the outer product matrix <img class="math" src="_images/math/7c5e1d02a7f308fbd919c92cc4303380e6f90550.png" alt="A^{(q)}(x)"/> at the location <a class="reference internal" href="#c.gsl_bspline_oprod" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>, where the
derivative order <img class="math" src="_images/math/b37ddf7d09edbcd8e9da5bb7965bdcc6ab32b507.png" alt="q"/> is specified by <a class="reference internal" href="#c.gsl_bspline_oprod" title="nderiv"><code class="xref c c-data docutils literal notranslate"><span class="pre">nderiv</span></code></a>. The matrix is stored in <a class="reference internal" href="#c.gsl_bspline_oprod" title="A"><code class="xref c c-data docutils literal notranslate"><span class="pre">A</span></code></a> in
<a class="reference internal" href="linalg.html#sec-symmetric-banded"><span class="std std-ref">symmetric banded</span></a> format, and so <a class="reference internal" href="#c.gsl_bspline_oprod" title="A"><code class="xref c c-data docutils literal notranslate"><span class="pre">A</span></code></a> has dimensions
<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>. Since the B-spline functions have local support, many elements of the
outer product matrix could be zero.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_gram">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_gram</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nderiv</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">G</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_gram" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function calculates the positive semi-definite Gram matrix <img class="math" src="_images/math/b9b10e5f7c826ff414c8ca5904bbce53213f71b0.png" alt="G_{ij}^{(q)}"/>, where the
derivative order <img class="math" src="_images/math/b37ddf7d09edbcd8e9da5bb7965bdcc6ab32b507.png" alt="q"/> is specified by <a class="reference internal" href="#c.gsl_bspline_gram" title="nderiv"><code class="xref c c-data docutils literal notranslate"><span class="pre">nderiv</span></code></a>. The matrix is stored in <a class="reference internal" href="#c.gsl_bspline_gram" title="G"><code class="xref c c-data docutils literal notranslate"><span class="pre">G</span></code></a> in
<a class="reference internal" href="linalg.html#sec-symmetric-banded"><span class="std std-ref">symmetric banded</span></a> format, and so <a class="reference internal" href="#c.gsl_bspline_gram" title="G"><code class="xref c c-data docutils literal notranslate"><span class="pre">G</span></code></a> has dimensions
<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>. The integrals are computed over the full support of the B-spline basis.</p>
<p>The algorithm uses Gauss-Legendre quadrature on each knot interval. See algorithm 5.22 of
L. Schumaker, “Spline Functions: Basic Theory”.</p>
</dd></dl>

<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_gram_interval">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_gram_interval</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">a</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="n"><span class="pre">b</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">nderiv</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">G</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_gram_interval" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function calculates the positive semi-definite Gram matrix <img class="math" src="_images/math/b9b10e5f7c826ff414c8ca5904bbce53213f71b0.png" alt="G_{ij}^{(q)}"/>, where the
derivative order <img class="math" src="_images/math/b37ddf7d09edbcd8e9da5bb7965bdcc6ab32b507.png" alt="q"/> is specified by <a class="reference internal" href="#c.gsl_bspline_gram_interval" title="nderiv"><code class="xref c c-data docutils literal notranslate"><span class="pre">nderiv</span></code></a>. The matrix is stored in <a class="reference internal" href="#c.gsl_bspline_gram_interval" title="G"><code class="xref c c-data docutils literal notranslate"><span class="pre">G</span></code></a> in
<a class="reference internal" href="linalg.html#sec-symmetric-banded"><span class="std std-ref">symmetric banded</span></a> format, and so <a class="reference internal" href="#c.gsl_bspline_gram_interval" title="G"><code class="xref c c-data docutils literal notranslate"><span class="pre">G</span></code></a> has dimensions
<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>. The integrals are computed over the interval <img class="math" src="_images/math/c47bfde07e072efe45e71eb8b5e6891be77ec2df.png" alt="[a,b]"/>.</p>
<p>The algorithm uses Gauss-Legendre quadrature on each knot interval. See algorithm 5.22 of
L. Schumaker, “Spline Functions: Basic Theory”.</p>
</dd></dl>

</div>
<div class="section" id="interpolation-with-b-splines">
<span id="index-11"></span><h2>Interpolation with B-splines<a class="headerlink" href="#interpolation-with-b-splines" title="Permalink to this heading">¶</a></h2>
<p>Given a set of <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> data points, <img class="math" src="_images/math/3cac6a62c3ca5ddb61cce70f724a9d49a7e399d0.png" alt="(x_i,y_i)"/>, we can
define an interpolating spline with <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> control points
which passes through each data point,</p>
<div class="math">
<p><img src="_images/math/681789e3ba11fb89141ea6cf5af29870589be849.png" alt="f(x_i) = \sum_{j=1}^n c_j B_j(x_i) = y_i, \quad i = 1,\dots,n"/></p>
</div><p>This is a square system of equations which can be solved by inverting
the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> <em>collocation matrix</em>, whose elements are
<img class="math" src="_images/math/4c9304148209a0df08d1515c09e404eb70903975.png" alt="B_j(x_i)"/>. In order for the collocation matrix to be invertible,
the <img class="math" src="_images/math/3efd6fd1c2b0c335484bcd4bf7d5d98b99e619f4.png" alt="x_i"/> and spline knots must satisfy the Schoenberg-Whitney conditions,
which are</p>
<div class="math">
<p><img src="_images/math/48fb9c0f94c85d6d76b2912ef3c4dcce3c923f12.png" alt="t_i &lt; x_i &lt; t_{i+k}, \quad i = 1,\dots,n"/></p>
</div><p>If these conditions are met, then the collocation matrix is banded,
with both the upper and lower bandwidths equal to <img class="math" src="_images/math/4c7ea67e12bcbba0d5be6a3914a0eb2d17ef2cd7.png" alt="k-1"/>. This
property leads to savings in storage and computation when solving
interpolation problems. To construct a knot vector which satisfies
these conditions, see the function <a class="reference internal" href="#c.gsl_bspline_init_interp" title="gsl_bspline_init_interp"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_bspline_init_interp()</span></code></a>.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_col_interp">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_col_interp</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <a class="reference internal" href="vectors.html#c.gsl_matrix" title="gsl_matrix"><span class="n"><span class="pre">gsl_matrix</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">XB</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_col_interp" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function constructs the banded collocation matrix to interpolate
the <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> abscissa values provided in <a class="reference internal" href="#c.gsl_bspline_col_interp" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>. The values in
<a class="reference internal" href="#c.gsl_bspline_col_interp" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a> must be sorted in ascending order, although this is not
checked explicitly by the function. The collocation
matrix is stored in <a class="reference internal" href="#c.gsl_bspline_col_interp" title="XB"><code class="xref c c-data docutils literal notranslate"><span class="pre">XB</span></code></a> on output in banded storage format suitable
for use with the banded LU routines. Therefore, <a class="reference internal" href="#c.gsl_bspline_col_interp" title="XB"><code class="xref c c-data docutils literal notranslate"><span class="pre">XB</span></code></a> must have dimension
<img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/>-by-<img class="math" src="_images/math/290315c8f810a4ea46b3f1a8ae25f697f02688ad.png" alt="3(k-1) + 1"/>.</p>
</dd></dl>

</div>
<div class="section" id="hermite-interpolation-with-b-splines">
<span id="index-12"></span><h2>Hermite Interpolation with B-splines<a class="headerlink" href="#hermite-interpolation-with-b-splines" title="Permalink to this heading">¶</a></h2>
<p>Given a set of <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> data interpolation sites,
<img class="math" src="_images/math/8635a289d12082492d9e807819d2dd5098554f98.png" alt="x_1 &lt; x_2 &lt; \dots &lt; x_n"/>, and a set of interpolation
values,</p>
<div class="math">
<p><img src="_images/math/9c97ed3728688e639be389589ae42025beef001d.png" alt="f_i^{(j)}, \qquad i=1,\dots,n, j=0,1,\dots,m"/></p>
</div><p>then there is a unique interpolating spline of order
<img class="math" src="_images/math/9482d33ec9043089db7b78132fa33ee1a596bacd.png" alt="k = 2m+2"/> which will match the given function values
(and their derivatives). The spline has <img class="math" src="_images/math/47584a63bf86cf087a043c7a462e8a384c743855.png" alt="(m+1)n"/> control
points and is given by,</p>
<div class="math">
<p><img src="_images/math/19b8d2944f83fcb39ea2f602823765d8177cb050.png" alt="f(x) = \sum_{j=1}^{(m+1)n} c_j B_j(x)"/></p>
</div><p>This spline will satisfy,</p>
<div class="math">
<p><img src="_images/math/d1cafa4e2ea9dbd8a7aa02a17da65eef5e114606.png" alt="f^{(j)}(x_i) = f_i^{(j)}, \qquad i=1,\dots,n, j=0,1,\dots,m"/></p>
</div><p>Mummy (1989) provides an efficient algorithm to determine the spline
coefficients <img class="math" src="_images/math/cac9610c2f66f7be8448849e4b2d8ccaddecf175.png" alt="c_j"/>.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_interp_chermite">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_interp_chermite</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">x</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">dy</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">c</span></span>, <span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_interp_chermite" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function will calculate the coefficients of an interpolating
cubic Hermite spline which match the provided function values <img class="math" src="_images/math/1b3578a89dede64b23bf558874c50fd32641e2cb.png" alt="y_i"/>
and first derivatives <img class="math" src="_images/math/159ea1638c66dfbb545c23e28efcc1a3230a8f19.png" alt="y'_i"/> at the interpolation sites
<img class="math" src="_images/math/3efd6fd1c2b0c335484bcd4bf7d5d98b99e619f4.png" alt="x_i"/>. The inputs <a class="reference internal" href="#c.gsl_bspline_interp_chermite" title="x"><code class="xref c c-data docutils literal notranslate"><span class="pre">x</span></code></a>, <a class="reference internal" href="#c.gsl_bspline_interp_chermite" title="y"><code class="xref c c-data docutils literal notranslate"><span class="pre">y</span></code></a>, <a class="reference internal" href="#c.gsl_bspline_interp_chermite" title="dy"><code class="xref c c-data docutils literal notranslate"><span class="pre">dy</span></code></a> are
all of the same length <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> and contain the <img class="math" src="_images/math/3efd6fd1c2b0c335484bcd4bf7d5d98b99e619f4.png" alt="x_i"/>,
<img class="math" src="_images/math/1b3578a89dede64b23bf558874c50fd32641e2cb.png" alt="y_i"/>, and <img class="math" src="_images/math/159ea1638c66dfbb545c23e28efcc1a3230a8f19.png" alt="y'_i"/> respectively. On output, the spline coefficients
are stored in <a class="reference internal" href="#c.gsl_bspline_interp_chermite" title="c"><code class="xref c c-data docutils literal notranslate"><span class="pre">c</span></code></a>, which must have length <img class="math" src="_images/math/01fbf7873faa8e28316a01eb321c7e28f36b7681.png" alt="2n"/>.</p>
<p>This function is specifically designed for cubic Hermite splines, and
so the spline order must be <img class="math" src="_images/math/d04fe653b8e542bb615b615b9365f98744d2557d.png" alt="k = 4"/>. The function
<a class="reference internal" href="#c.gsl_bspline_init_hermite" title="gsl_bspline_init_hermite"><code class="xref c c-func docutils literal notranslate"><span class="pre">gsl_bspline_init_hermite()</span></code></a> must be called to initialize the knot vector.
The algorithm used is provided by Mummy (1989).</p>
</dd></dl>

</div>
<div class="section" id="projection-onto-the-b-spline-basis">
<h2>Projection onto the B-spline Basis<a class="headerlink" href="#projection-onto-the-b-spline-basis" title="Permalink to this heading">¶</a></h2>
<p>A function <img class="math" src="_images/math/affcac78cbf3ede97b9d3996b222aff08b185b08.png" alt="f(x)"/> can be projected onto the subspace <img class="math" src="_images/math/1029ba66db5e291908984e3b2d2ef872e08eb580.png" alt="V = \textrm{span}(B_i)"/> spanned
by the B-splines as follows,</p>
<div class="math">
<p><img src="_images/math/19e196f628ce8e9a08713a9e9f1ccc393a9aba97.png" alt="f(x) \approx \textrm{proj}_V(f) = \sum_j c_j B_j(x)"/></p>
</div><p>If <img class="math" src="_images/math/affcac78cbf3ede97b9d3996b222aff08b185b08.png" alt="f(x)"/> is a piecewise polynomial of degree less than <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>, then <img class="math" src="_images/math/affcac78cbf3ede97b9d3996b222aff08b185b08.png" alt="f(x)"/> will
lie in <img class="math" src="_images/math/c4b9de55f86fc0a11a30113a1ff1468a7729c621.png" alt="V"/> and <img class="math" src="_images/math/54c62e8070e5a1d9de81a2ae0a07814682f662f0.png" alt="f(x) = \textrm{proj}_V(f)"/>. The expansion coefficients <img class="math" src="_images/math/cac9610c2f66f7be8448849e4b2d8ccaddecf175.png" alt="c_j"/> can be
calculated as follows,</p>
<div class="math">
<p><img src="_images/math/9824facb966840f515e13483c3f7d7c3d341bbdd.png" alt="f(x) B_i(x) &amp;= \sum_j c_j B_j(x) B_i(x) \\
\underbrace{\int f(x) B_i(x) dx}_{y_i} &amp;= \sum_j c_j \underbrace{\int B_i(x) B_j(x) dx}_{G_{ij}} \\
G c &amp;= y"/></p>
</div><p>where <img class="math" src="_images/math/f5295044f66ab7fe74a7120a197288cc3f042278.png" alt="G"/> is the <a class="reference internal" href="#sec-bspline-gram"><span class="std std-ref">B-spline Gram Matrix</span></a>. The above equation can
be solved using a Cholesky factorization of <img class="math" src="_images/math/f5295044f66ab7fe74a7120a197288cc3f042278.png" alt="G"/>.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_proj_rhs">
<span class="kt"><span class="pre">int</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_proj_rhs</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><a class="reference internal" href="roots.html#c.gsl_function" title="gsl_function"><span class="n"><span class="pre">gsl_function</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">F</span></span>, <a class="reference internal" href="vectors.html#c.gsl_vector" title="gsl_vector"><span class="n"><span class="pre">gsl_vector</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">y</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_proj_rhs" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This function computes the right hand side vector <img class="math" src="_images/math/f4ecfd46c49c1cbd9db79881fc4727d48fa6c84b.png" alt="y_i = \int f(x) B_i(x) dx"/> for projecting
a function <a class="reference internal" href="#c.gsl_bspline_proj_rhs" title="F"><code class="xref c c-data docutils literal notranslate"><span class="pre">F</span></code></a> onto the B-spline basis. The output is stored in <a class="reference internal" href="#c.gsl_bspline_proj_rhs" title="y"><code class="xref c c-data docutils literal notranslate"><span class="pre">y</span></code></a> which must have
size <code class="code docutils literal notranslate"><span class="pre">ncontrol</span></code>. The integrals are computed using Gauss-Legendre quadrature, which will
produce exact results if <img class="math" src="_images/math/affcac78cbf3ede97b9d3996b222aff08b185b08.png" alt="f(x)"/> is a piecewise polynomial of degree less than <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>.</p>
</dd></dl>

</div>
<div class="section" id="greville-abscissae">
<span id="index-13"></span><h2>Greville abscissae<a class="headerlink" href="#greville-abscissae" title="Permalink to this heading">¶</a></h2>
<p>The Greville abscissae are defined to be the mean location of <img class="math" src="_images/math/4c7ea67e12bcbba0d5be6a3914a0eb2d17ef2cd7.png" alt="k-1"/>
consecutive knots in the knot vector for each basis spline function of order
<img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>.  With the first and last knots in the knot vector excluded,
there are <img class="math" src="_images/math/f43dc929f43b9ea0d06d0c87855b9e50ee4479ea.png" alt="n"/> Greville abscissae
for any given B-spline basis.  These values are often used in B-spline
collocation applications and may also be called Marsden-Schoenberg points.</p>
<dl class="c function">
<dt class="sig sig-object c" id="c.gsl_bspline_greville_abscissa">
<span class="kt"><span class="pre">double</span></span><span class="w"> </span><span class="sig-name descname"><span class="n"><span class="pre">gsl_bspline_greville_abscissa</span></span></span><span class="sig-paren">(</span><span class="k"><span class="pre">const</span></span><span class="w"> </span><span class="n"><span class="pre">size_t</span></span><span class="w"> </span><span class="n"><span class="pre">i</span></span>, <a class="reference internal" href="#c.gsl_bspline_workspace" title="gsl_bspline_workspace"><span class="n"><span class="pre">gsl_bspline_workspace</span></span></a><span class="w"> </span><span class="p"><span class="pre">*</span></span><span class="n"><span class="pre">w</span></span><span class="sig-paren">)</span><a class="headerlink" href="#c.gsl_bspline_greville_abscissa" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Returns the location of the <img class="math" src="_images/math/8ba3c887c6b69d4f3fc99ada2119799a385a325f.png" alt="i"/>-th Greville abscissa for the given
B-spline basis.  For the ill-defined case when <img class="math" src="_images/math/6ccaea625fcf9b006c06a4c84209dedd25d73943.png" alt="k = 1"/>, the implementation
chooses to return breakpoint interval midpoints.</p>
</dd></dl>

</div>
<div class="section" id="examples">
<span id="index-14"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h2>
<div class="section" id="example-1-basis-splines-and-uniform-knots">
<h3>Example 1: Basis Splines and Uniform Knots<a class="headerlink" href="#example-1-basis-splines-and-uniform-knots" title="Permalink to this heading">¶</a></h3>
<p>The following program computes and outputs linear, quadratic, cubic, and
quartic basis splines using uniform knots on the interval <img class="math" src="_images/math/e7e8ac4ddd4ab0fc62c2a6435f8373f48c776858.png" alt="[0,1]"/>.
The knot vector is</p>
<div class="math">
<p><img src="_images/math/f1c279d5e32c17dbc8fb3a672cd7a83569af7833.png" alt="\mathbf{t} = \left( \underbrace{0, \dots, 0}_{k}, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, \underbrace{1, \dots, 1}_{k} \right)"/></p>
</div><p>where the first and last knot are repeated <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/> times, where <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/> is the spline
order.  The output is shown in <a class="reference internal" href="#fig-bspline-knots"><span class="std std-numref">Fig. 40</span></a>.</p>
<div class="figure align-default" id="id1">
<span id="fig-bspline-knots"></span><a class="reference internal image-reference" href="_images/bspline_knots.png"><img alt="_images/bspline_knots.png" src="_images/bspline_knots.png" style="width: 1200.0px; height: 720.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 40 </span><span class="caption-text">Linear, quadratic, cubic, and quartic basis splines defined on the interval
<img class="math" src="_images/math/e7e8ac4ddd4ab0fc62c2a6435f8373f48c776858.png" alt="[0,1]"/> with uniform knots. Black circles denote the location of
the knots.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>This figure makes it clear that each B-spline has local support and spans
<img class="math" src="_images/math/3a3c8297a4ef107ea40aa6a47ae8aed9bebd3eb4.png" alt="k + 1"/> knots. The B-splines near the interval endpoints appear to span
less knots, but note that the endpoint knots have multiplicities of <img class="math" src="_images/math/71e6c03676f7f43b827bdaf404bc29149f5d99d7.png" alt="k"/>.</p>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_vector.h&gt;</span>

<span class="n">void</span>
<span class="n">print_basis</span><span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="n">fp_knots</span><span class="p">,</span> <span class="n">FILE</span> <span class="o">*</span><span class="n">fp_spline</span><span class="p">,</span> <span class="n">const</span> <span class="n">size_t</span> <span class="n">order</span><span class="p">,</span> <span class="n">const</span> <span class="n">size_t</span> <span class="n">nbreak</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">nbreak</span><span class="p">);</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">p</span> <span class="o">=</span> <span class="n">gsl_bspline_ncontrol</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">B</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
  <span class="n">size_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

  <span class="o">/*</span> <span class="n">use</span> <span class="n">uniform</span> <span class="n">breakpoints</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>

  <span class="n">gsl_vector_fprintf</span><span class="p">(</span><span class="n">fp_knots</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">knots</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">xi</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dx</span><span class="p">;</span>

      <span class="n">gsl_bspline_eval_basis</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>

      <span class="n">fprintf</span><span class="p">(</span><span class="n">fp_spline</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">fp_spline</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">gsl_vector_get</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>

      <span class="n">fprintf</span><span class="p">(</span><span class="n">fp_spline</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">fprintf</span><span class="p">(</span><span class="n">fp_knots</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="n">fp_spline</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">nbreak</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">breakpoints</span> <span class="o">*/</span>
  <span class="n">FILE</span> <span class="o">*</span><span class="n">fp_knots</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s2">&quot;bspline1_knots.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span>
  <span class="n">FILE</span> <span class="o">*</span><span class="n">fp_spline</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s2">&quot;bspline1.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span>

  <span class="n">print_basis</span><span class="p">(</span><span class="n">fp_knots</span><span class="p">,</span> <span class="n">fp_spline</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">nbreak</span><span class="p">);</span> <span class="o">/*</span> <span class="n">linear</span> <span class="n">splines</span> <span class="o">*/</span>
  <span class="n">print_basis</span><span class="p">(</span><span class="n">fp_knots</span><span class="p">,</span> <span class="n">fp_spline</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nbreak</span><span class="p">);</span> <span class="o">/*</span> <span class="n">quadratic</span> <span class="n">splines</span> <span class="o">*/</span>
  <span class="n">print_basis</span><span class="p">(</span><span class="n">fp_knots</span><span class="p">,</span> <span class="n">fp_spline</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nbreak</span><span class="p">);</span> <span class="o">/*</span> <span class="n">cubic</span> <span class="n">splines</span> <span class="o">*/</span>
  <span class="n">print_basis</span><span class="p">(</span><span class="n">fp_knots</span><span class="p">,</span> <span class="n">fp_spline</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">nbreak</span><span class="p">);</span> <span class="o">/*</span> <span class="n">quartic</span> <span class="n">splines</span> <span class="o">*/</span>

  <span class="n">fclose</span><span class="p">(</span><span class="n">fp_knots</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">fp_spline</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2-derivatives-of-basis-splines">
<h3>Example 2: Derivatives of Basis Splines<a class="headerlink" href="#example-2-derivatives-of-basis-splines" title="Permalink to this heading">¶</a></h3>
<p>The following program computes and outputs cubic B-splines and their
derivatives using <img class="math" src="_images/math/dbff8d724356ac25e885ebdb35deaae8cb8ff882.png" alt="6"/> breakpoints and uniform knots on the interval
<img class="math" src="_images/math/e7e8ac4ddd4ab0fc62c2a6435f8373f48c776858.png" alt="[0,1]"/>. All derivatives up to order <img class="math" src="_images/math/eac96ffbc1b2aee2dbf6675ef30fdf2a74a3d82f.png" alt="3"/> are computed.
The output is shown in <a class="reference internal" href="#fig-bspline2"><span class="std std-numref">Fig. 41</span></a>.</p>
<div class="figure align-default" id="id2">
<span id="fig-bspline2"></span><a class="reference internal image-reference" href="_images/bspline_deriv.png"><img alt="_images/bspline_deriv.png" src="_images/bspline_deriv.png" style="width: 1200.0px; height: 720.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 41 </span><span class="caption-text">Cubic B-splines and derivatives up to order 3.  Black circles
denote the location of the knots.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_matrix.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">nbreak</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">spline_order</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc</span><span class="p">(</span><span class="n">spline_order</span><span class="p">,</span> <span class="n">nbreak</span><span class="p">);</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">p</span> <span class="o">=</span> <span class="n">gsl_bspline_ncontrol</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">dB</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">spline_order</span><span class="p">);</span>
  <span class="n">size_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>

  <span class="o">/*</span> <span class="n">uniform</span> <span class="n">breakpoints</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">knot</span> <span class="n">vector</span> <span class="o">*/</span>
  <span class="n">gsl_vector_fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">knots</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spline_order</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">double</span> <span class="n">xj</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="n">dx</span><span class="p">;</span>

          <span class="n">gsl_bspline_eval_deriv_basis</span><span class="p">(</span><span class="n">xj</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dB</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>

          <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">xj</span><span class="p">);</span>

          <span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
            <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">gsl_matrix_get</span><span class="p">(</span><span class="n">dB</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>

          <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
        <span class="p">}</span>

      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">dB</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-3-least-squares-and-breakpoints">
<h3>Example 3: Least squares and breakpoints<a class="headerlink" href="#example-3-least-squares-and-breakpoints" title="Permalink to this heading">¶</a></h3>
<p>The following program computes a linear least squares fit to data using
cubic B-splines with uniform breakpoints. The data is generated from
the curve <img class="math" src="_images/math/24c59d4f63abe63dfacf10b6fa4c9e3fbd51adea.png" alt="y(x) = \cos{x} \exp{\left( -x/10 \right)}"/> with Gaussian noise added.
Splines are fitted with <img class="math" src="_images/math/8f8a44e9f9b7ef1fb7d0e9585dc08a38a6f89021.png" alt="10"/> and <img class="math" src="_images/math/86f56b7b881213b48cfdc239c058bf494cecd740.png" alt="40"/> breakpoints for comparison.</p>
<p>The program output is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./a.out &gt; bspline_lsbreak.txt
40 breakpoints: chisq/dof = 1.008999e+00
10 breakpoints: chisq/dof = 1.014761e+00
</pre></div>
</div>
<p>The data and fitted models are shown in <a class="reference internal" href="#fig-bspline-lsbreak"><span class="std std-numref">Fig. 42</span></a>.</p>
<div class="figure align-default" id="id3">
<span id="fig-bspline-lsbreak"></span><a class="reference internal image-reference" href="_images/bspline_lsbreak.png"><img alt="_images/bspline_lsbreak.png" src="_images/bspline_lsbreak.png" style="width: 720.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 42 </span><span class="caption-text">Cubic B-spline least squares fit</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_rng.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_randist.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_statistics.h&gt;</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>     <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">data</span> <span class="n">points</span> <span class="n">to</span> <span class="n">fit</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>       <span class="o">/*</span> <span class="n">spline</span> <span class="n">order</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>     <span class="o">/*</span> <span class="n">data</span> <span class="n">interval</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="o">/*</span> <span class="n">noise</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">work1</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>   <span class="o">/*</span> <span class="mi">40</span> <span class="n">breakpoints</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">work2</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>   <span class="o">/*</span> <span class="mi">10</span> <span class="n">breakpoints</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">gsl_bspline_ncontrol</span><span class="p">(</span><span class="n">work1</span><span class="p">);</span>             <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">control</span> <span class="n">points</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">gsl_bspline_ncontrol</span><span class="p">(</span><span class="n">work2</span><span class="p">);</span>             <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">control</span> <span class="n">points</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">dof1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span>                                <span class="o">/*</span> <span class="n">degrees</span> <span class="n">of</span> <span class="n">freedom</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">dof2</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p2</span><span class="p">;</span>                                <span class="o">/*</span> <span class="n">degrees</span> <span class="n">of</span> <span class="n">freedom</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">c1</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">c2</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">gsl_rng</span> <span class="o">*</span><span class="n">r</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">chisq1</span><span class="p">,</span> <span class="n">chisq2</span><span class="p">;</span>

  <span class="n">gsl_rng_env_setup</span><span class="p">();</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">gsl_rng_alloc</span><span class="p">(</span><span class="n">gsl_rng_default</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">fitted</span> <span class="o">*/</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">xi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">a</span><span class="p">;</span>
      <span class="n">double</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">xi</span><span class="p">);</span>
      <span class="n">double</span> <span class="n">dyi</span> <span class="o">=</span> <span class="n">gsl_ran_gaussian</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">);</span>

      <span class="n">yi</span> <span class="o">+=</span> <span class="n">dyi</span><span class="p">;</span>

      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">));</span>

      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="o">/*</span> <span class="n">use</span> <span class="n">uniform</span> <span class="n">breakpoints</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">work1</span><span class="p">);</span>
  <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">work2</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">solve</span> <span class="n">least</span> <span class="n">squares</span> <span class="n">problem</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_wlssolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">chisq1</span><span class="p">,</span> <span class="n">work1</span><span class="p">);</span>
  <span class="n">gsl_bspline_wlssolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">chisq2</span><span class="p">,</span> <span class="n">work2</span><span class="p">);</span>

  <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;40 breakpoints: chisq/dof = </span><span class="si">%e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">chisq1</span> <span class="o">/</span> <span class="n">dof1</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;10 breakpoints: chisq/dof = </span><span class="si">%e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">chisq2</span> <span class="o">/</span> <span class="n">dof2</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">the</span> <span class="n">spline</span> <span class="n">curves</span> <span class="o">*/</span>
  <span class="p">{</span>
    <span class="n">double</span> <span class="n">xi</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">xi</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">;</span> <span class="n">xi</span> <span class="o">+=</span> <span class="mf">0.1</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">double</span> <span class="n">result1</span><span class="p">,</span> <span class="n">result2</span><span class="p">;</span>

        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result1</span><span class="p">,</span> <span class="n">work1</span><span class="p">);</span>
        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result2</span><span class="p">,</span> <span class="n">work2</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">result1</span><span class="p">,</span> <span class="n">result2</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">gsl_rng_free</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">c1</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">c2</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">work1</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">work2</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-4-least-squares-and-spline-order">
<h3>Example 4: Least squares and spline order<a class="headerlink" href="#example-4-least-squares-and-spline-order" title="Permalink to this heading">¶</a></h3>
<p>The following program computes least squares fits to the same
dataset in the previous example, using <img class="math" src="_images/math/8f8a44e9f9b7ef1fb7d0e9585dc08a38a6f89021.png" alt="10"/> uniform
breakpoints and computing splines of order <img class="math" src="_images/math/4ff030d15098d4e0d1b21a0d187e8ce6821df35a.png" alt="1,2,3,4,5"/>.</p>
<p>The data and fitted models are shown in <a class="reference internal" href="#fig-bspline-lsorder"><span class="std std-numref">Fig. 43</span></a>.</p>
<div class="figure align-default" id="id4">
<span id="fig-bspline-lsorder"></span><a class="reference internal image-reference" href="_images/bspline_lsorder.png"><img alt="_images/bspline_lsorder.png" src="_images/bspline_lsorder.png" style="width: 720.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 43 </span><span class="caption-text">B-spline least squares fit with varying spline orders</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_rng.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_randist.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_statistics.h&gt;</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>              <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">data</span> <span class="n">points</span> <span class="n">to</span> <span class="n">fit</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>              <span class="o">/*</span> <span class="n">data</span> <span class="n">interval</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">max_spline_order</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="o">/*</span> <span class="n">maximum</span> <span class="n">spline</span> <span class="n">order</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">nbreak</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">breakpoints</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">noise</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">**</span><span class="n">work</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">max_spline_order</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="p">));</span>
  <span class="n">gsl_vector</span> <span class="o">**</span><span class="n">c</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">max_spline_order</span> <span class="o">*</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">gsl_vector</span> <span class="o">*</span><span class="p">));</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">gsl_rng</span> <span class="o">*</span><span class="n">r</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">chisq</span><span class="p">;</span>

  <span class="n">gsl_rng_env_setup</span><span class="p">();</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">gsl_rng_alloc</span><span class="p">(</span><span class="n">gsl_rng_default</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">fitted</span> <span class="o">*/</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">xi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">a</span><span class="p">;</span>
      <span class="n">double</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">xi</span><span class="p">);</span>
      <span class="n">double</span> <span class="n">dyi</span> <span class="o">=</span> <span class="n">gsl_ran_gaussian</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">);</span>

      <span class="n">yi</span> <span class="o">+=</span> <span class="n">dyi</span><span class="p">;</span>

      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">));</span>

      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">max_spline_order</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="o">/*</span> <span class="n">allocate</span> <span class="n">workspace</span> <span class="k">for</span> <span class="n">this</span> <span class="n">spline</span> <span class="n">order</span> <span class="o">*/</span>
      <span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nbreak</span><span class="p">);</span>
      <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">gsl_bspline_ncontrol</span><span class="p">(</span><span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>

      <span class="o">/*</span> <span class="n">use</span> <span class="n">uniform</span> <span class="n">breakpoints</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
      <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

      <span class="o">/*</span> <span class="n">solve</span> <span class="n">least</span> <span class="n">squares</span> <span class="n">problem</span> <span class="o">*/</span>
      <span class="n">gsl_bspline_wlssolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">chisq</span><span class="p">,</span> <span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">the</span> <span class="n">spline</span> <span class="n">curves</span> <span class="o">*/</span>
  <span class="p">{</span>
    <span class="n">double</span> <span class="n">xi</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">xi</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">;</span> <span class="n">xi</span> <span class="o">+=</span> <span class="mf">0.1</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">max_spline_order</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
          <span class="p">{</span>
            <span class="n">double</span> <span class="n">result</span><span class="p">;</span>
            <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">max_spline_order</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
      <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">work</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>

  <span class="n">gsl_rng_free</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-5-least-squares-regularization-and-the-gram-matrix">
<h3>Example 5: Least squares, regularization and the Gram matrix<a class="headerlink" href="#example-5-least-squares-regularization-and-the-gram-matrix" title="Permalink to this heading">¶</a></h3>
<p>The following example program fits a cubic B-spline to data generated
from the Gaussian</p>
<div class="math">
<p><img src="_images/math/e107a949cdcd2d479a75ed93dec4b638437dd426.png" alt="g(x) = e^{-x^2}"/></p>
</div><p>on the interval <img class="math" src="_images/math/5b8fb2774bf010da025750345b5d78a394046efa.png" alt="[-1.5,1.5]"/> with noise added. Two data gaps are
deliberately introduced on <img class="math" src="_images/math/571ace076165f9edfc8e92915fd3c0abd2c5b0d3.png" alt="[-1.1,-0.7]"/> and <img class="math" src="_images/math/9edc1617d6e5b9299bae122dddf83721982fb11e.png" alt="[0.1,0.55]"/>,
which makes the problem ill-posed. <a class="reference internal" href="#fig-bspline-gram1"><span class="std std-numref">Fig. 44</span></a> shows
that the ordinary least squares solution exhibits large errors in
the data gap regions due to the ill-conditioned least squares matrix.</p>
<p>One way to correct the situation is to minimize the data misfit but
also minimize the curvature of the spline averaged over the full interval.
We can define the average curvature using the second derivative of the
spline as follows:</p>
<div class="math">
<p><img src="_images/math/02933a01f1b8a7890395cd7346f4d516020f6588.png" alt="\textrm{curvature} &amp;\approx \int \left| \frac{d^2}{dx^2} f(x) \right|^2 dx \\
                   &amp;= \int \left| \frac{d^2}{dx^2} \sum_{i=1}^n c_i B_i(x) \right|^2 dx \\
                   &amp;= \int \left| \sum_{i=1}^n c_i B''_i(x) \right|^2 dx \\
                   &amp;= \int \left| c^T B''(x) \right|^2 dx \\
                   &amp;= \int c^T B''(x) B''^T(x) c dx \\
                   &amp;= c^T \left( \int B''(x) B''^T(x) dx \right) c \\
                   &amp;= c^T G^{(2)} c"/></p>
</div><p>where <img class="math" src="_images/math/09ed28d84ba9a6804439f5cd10c75ab03aebc8bb.png" alt="G^{(2)}"/> is the <a class="reference internal" href="#sec-bspline-gram"><span class="std std-ref">Gram matrix</span></a> of second derivatives of the B-splines.
Therefore, our regularized least squares problem is</p>
<div class="math">
<p><img src="_images/math/05707f3deba5b58c1b107f5b8511c2d1496adce7.png" alt="\min_{c} || y - X c ||_W^2 + \lambda^2 c^T G^{(2)} c"/></p>
</div><p>where the regularization parameter <img class="math" src="_images/math/fc0c811948cbe72d26ba5a50f9b570c7a3581426.png" alt="\lambda^2"/> represents a tradeoff between
minimizing the data misfit and minimizing the spline curvature.
The solution of this least-squares problem is</p>
<div class="math">
<p><img src="_images/math/5796a111fce67e6be5c9fe2a22c175b0bbf29203.png" alt="c = \left( X^T W X + \lambda^2 G^{(2)} \right)^{-1} X^T W y"/></p>
</div><p>The example program below solves this problem without regularization <img class="math" src="_images/math/50f6a798bc9f75e04a1b2da3e0b6e82f418cf647.png" alt="(\lambda^2 = 0)"/>
and with regularization <img class="math" src="_images/math/d64b956e1fabf620bc4a1fc4a2f3abbe9d425f72.png" alt="(\lambda^2 = 0.1)"/> for comparison. We also plot
the <img class="math" src="_images/math/c8d7227a37bfb261f39b6ff29329fd2a011114ab.png" alt="1 \sigma"/> confidence intervals for both solutions using the diagonal elements
of the covariance matrix <img class="math" src="_images/math/0f482e0aec3c6c5efe4155042da08263d2f9e038.png" alt="\textrm{Cov} = \left( X^T W X + \lambda^2 G^{(2)} \right)^{-1}"/>.</p>
<p><a class="reference internal" href="#fig-bspline-gram1"><span class="std std-numref">Fig. 44</span></a> shows the result of regularizing the spline over the full
interval, using the command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">a</span><span class="o">.</span><span class="n">out</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<div class="figure align-default" id="id5">
<span id="fig-bspline-gram1"></span><a class="reference internal image-reference" href="_images/bspline_gram1.png"><img alt="_images/bspline_gram1.png" src="_images/bspline_gram1.png" style="width: 720.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 44 </span><span class="caption-text">B-spline least squares fit with exact (green), unregularized (red with <img class="math" src="_images/math/c8d7227a37bfb261f39b6ff29329fd2a011114ab.png" alt="1 \sigma"/> confidence intervals),
and fully regularized (blue with <img class="math" src="_images/math/c8d7227a37bfb261f39b6ff29329fd2a011114ab.png" alt="1 \sigma"/> confidence intervals) solutions.</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p><a class="reference internal" href="#fig-bspline-gram2"><span class="std std-numref">Fig. 45</span></a> shows the result of regularizing the spline over the smaller
interval <img class="math" src="_images/math/8a2c3be58a5d1044c16d84f2d735113a712e8446.png" alt="[0,0.6]"/>, correcting only the second gap, using the command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">a</span><span class="o">.</span><span class="n">out</span> <span class="mi">0</span> <span class="mf">0.6</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<div class="figure align-default" id="id6">
<span id="fig-bspline-gram2"></span><a class="reference internal image-reference" href="_images/bspline_gram2.png"><img alt="_images/bspline_gram2.png" src="_images/bspline_gram2.png" style="width: 720.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 45 </span><span class="caption-text">B-spline least squares fit with exact (green), unregularized (red with <img class="math" src="_images/math/c8d7227a37bfb261f39b6ff29329fd2a011114ab.png" alt="1 \sigma"/> confidence intervals),
and partially regularized (blue with <img class="math" src="_images/math/c8d7227a37bfb261f39b6ff29329fd2a011114ab.png" alt="1 \sigma"/> confidence intervals) solutions.</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_matrix.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_vector.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_linalg.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_rng.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_randist.h&gt;</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>                                     <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">data</span> <span class="n">points</span> <span class="n">to</span> <span class="n">fit</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>                                       <span class="o">/*</span> <span class="n">spline</span> <span class="n">order</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">;</span>                                    <span class="o">/*</span> <span class="n">data</span> <span class="n">interval</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">;</span>                                <span class="o">/*</span> <span class="n">noise</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">lambda_sq</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>                             <span class="o">/*</span> <span class="n">regularization</span> <span class="n">parameter</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">work</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>   <span class="o">/*</span> <span class="mi">25</span> <span class="n">breakpoints</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">p</span> <span class="o">=</span> <span class="n">gsl_bspline_ncontrol</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>              <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">control</span> <span class="n">points</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">control</span> <span class="n">points</span> <span class="k">for</span> <span class="n">unregularized</span> <span class="n">model</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">creg</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>                   <span class="o">/*</span> <span class="n">control</span> <span class="n">points</span> <span class="k">for</span> <span class="n">regularized</span> <span class="n">model</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">x</span> <span class="n">data</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">y</span> <span class="n">data</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">data</span> <span class="n">weights</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">XTX</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>                 <span class="o">/*</span> <span class="n">normal</span> <span class="n">equations</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">XTy</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>                    <span class="o">/*</span> <span class="n">normal</span> <span class="n">equations</span> <span class="n">rhs</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">cov</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>                 <span class="o">/*</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">cov_reg</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>             <span class="o">/*</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="k">for</span> <span class="n">regularized</span> <span class="n">model</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">G</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>                   <span class="o">/*</span> <span class="n">regularization</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">double</span> <span class="n">reg_a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>                                      <span class="o">/*</span> <span class="n">regularization</span> <span class="n">interval</span> <span class="p">[</span><span class="n">reg_a</span><span class="p">,</span><span class="n">reg_b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">double</span> <span class="n">reg_b</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
  <span class="nb">int</span> <span class="n">reg_interval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                                     <span class="o">/*</span> <span class="n">apply</span> <span class="n">regularization</span> <span class="n">on</span> <span class="n">smaller</span> <span class="n">interval</span> <span class="o">*/</span>
  <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">gsl_rng</span> <span class="o">*</span><span class="n">r</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">reg_a</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
      <span class="n">reg_b</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
      <span class="n">reg_interval</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="n">gsl_rng_env_setup</span><span class="p">();</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">gsl_rng_alloc</span><span class="p">(</span><span class="n">gsl_rng_default</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">fitted</span> <span class="o">*/</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">gsl_rng_uniform</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
      <span class="n">double</span> <span class="n">xi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">ui</span> <span class="o">+</span> <span class="n">a</span><span class="p">;</span>
      <span class="n">double</span> <span class="n">yi</span><span class="p">,</span> <span class="n">dyi</span><span class="p">;</span>

      <span class="o">/*</span> <span class="n">data</span> <span class="n">gaps</span> <span class="n">between</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.7</span><span class="p">]</span> <span class="ow">and</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">]</span> <span class="o">*/</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">xi</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.1</span> <span class="o">&amp;&amp;</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">xi</span> <span class="o">&gt;=</span> <span class="mf">0.1</span> <span class="o">&amp;&amp;</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="mf">0.55</span><span class="p">))</span>
        <span class="k">continue</span><span class="p">;</span>

      <span class="n">dyi</span> <span class="o">=</span> <span class="n">gsl_ran_gaussian</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">);</span>
      <span class="n">yi</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xi</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">+</span> <span class="n">dyi</span><span class="p">;</span>

      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">));</span>

      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>

      <span class="o">++</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">use</span> <span class="n">uniform</span> <span class="n">breakpoints</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="n">gsl_bspline_lsnormal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">XTy</span><span class="p">,</span> <span class="n">XTX</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span> <span class="o">/*</span> <span class="n">form</span> <span class="n">normal</span> <span class="n">equations</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_cholesky_band_decomp</span><span class="p">(</span><span class="n">XTX</span><span class="p">);</span>          <span class="o">/*</span> <span class="n">banded</span> <span class="n">Cholesky</span> <span class="n">decomposition</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_cholesky_band_solve</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">XTy</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>   <span class="o">/*</span> <span class="n">solve</span> <span class="k">for</span> <span class="n">unregularized</span> <span class="n">solution</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_covariance</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>        <span class="o">/*</span> <span class="n">compute</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="o">*/</span>

  <span class="o">/*</span> <span class="n">compute</span> <span class="n">regularization</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">reg_interval</span><span class="p">)</span>
    <span class="n">gsl_bspline_gram_interval</span><span class="p">(</span><span class="n">reg_a</span><span class="p">,</span> <span class="n">reg_b</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">gsl_bspline_gram</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">multiply</span> <span class="n">by</span> <span class="k">lambda</span><span class="o">^</span><span class="mi">2</span> <span class="o">*/</span>
  <span class="n">gsl_matrix_scale</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">lambda_sq</span><span class="p">);</span>

  <span class="n">gsl_bspline_lsnormal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">XTy</span><span class="p">,</span> <span class="n">XTX</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>  <span class="o">/*</span> <span class="n">form</span> <span class="n">normal</span> <span class="n">equations</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_matrix_add</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">G</span><span class="p">);</span>                         <span class="o">/*</span> <span class="n">add</span> <span class="n">regularization</span> <span class="n">term</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_cholesky_band_decomp</span><span class="p">(</span><span class="n">XTX</span><span class="p">);</span>           <span class="o">/*</span> <span class="n">banded</span> <span class="n">Cholesky</span> <span class="n">decomposition</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_cholesky_band_solve</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">XTy</span><span class="p">,</span> <span class="n">creg</span><span class="p">);</span> <span class="o">/*</span> <span class="n">solve</span> <span class="k">for</span> <span class="n">regularized</span> <span class="n">solution</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_covariance</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">cov_reg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>     <span class="o">/*</span> <span class="n">compute</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="o">*/</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">the</span> <span class="n">spline</span> <span class="n">curves</span> <span class="o">*/</span>
  <span class="p">{</span>
    <span class="n">double</span> <span class="n">xi</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">xi</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">;</span> <span class="n">xi</span> <span class="o">+=</span> <span class="mf">0.01</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">double</span> <span class="n">result_unreg</span><span class="p">,</span> <span class="n">result_reg</span><span class="p">;</span>
        <span class="n">double</span> <span class="n">err_unreg</span><span class="p">,</span> <span class="n">err_reg</span><span class="p">;</span>

        <span class="o">/*</span> <span class="n">compute</span> <span class="n">unregularized</span> <span class="n">spline</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">error</span> <span class="n">at</span> <span class="n">xi</span> <span class="o">*/</span>
        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result_unreg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
        <span class="n">gsl_bspline_err</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err_unreg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

        <span class="o">/*</span> <span class="n">compute</span> <span class="n">regularized</span> <span class="n">spline</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">error</span> <span class="n">at</span> <span class="n">xi</span> <span class="o">*/</span>
        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">creg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result_reg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
        <span class="n">gsl_bspline_err</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cov_reg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err_reg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
               <span class="n">xi</span><span class="p">,</span>
               <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xi</span><span class="o">*</span><span class="n">xi</span><span class="p">),</span>
               <span class="n">result_unreg</span><span class="p">,</span>
               <span class="n">err_unreg</span><span class="p">,</span>
               <span class="n">result_reg</span><span class="p">,</span>
               <span class="n">err_reg</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">gsl_rng_free</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">creg</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">XTX</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">XTy</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">cov</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">cov_reg</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-6-least-squares-and-endpoint-regularization">
<h3>Example 6: Least squares and endpoint regularization<a class="headerlink" href="#example-6-least-squares-and-endpoint-regularization" title="Permalink to this heading">¶</a></h3>
<p>Data fitting with splines can often produce undesired effects at the spline
endpoints, where they are less constrained by data. As an example, we fit
order <img class="math" src="_images/math/9cc1cbaf3f19fb7a422a48d14c48451091f00d16.png" alt="k = 10"/> splines to the Runge function,</p>
<div class="math">
<p><img src="_images/math/5abec862d2038372b5b41dd281475b0576e7cb51.png" alt="g(x) = \frac{1}{1 + 25 x^2}"/></p>
</div><p>with 20 uniform breakpoints on the interval <img class="math" src="_images/math/1d53e8290434bdaf49584e0f83dc4119774a9397.png" alt="[a,b] = [-1,1]"/>.
<a class="reference internal" href="#fig-bspline-lsend"><span class="std std-numref">Fig. 46</span></a> shows that the fitted spline (red) exhibits
a sharp upward feature at the left endpoint. This is due to the lack
of data constraining this part of the spline, and would likely result
in errors if the user wanted to extrapolate the spline outside the fit
interval. One method to correct this is to apply regularization to
the spline at the endpoints by minimizing one or more of its derivatives.
In this example, we minimize the first derivative of the spline at both
endpoints, <img class="math" src="_images/math/9a8d8d9337ac0ab1087f541c4361d0f33db86969.png" alt="|f'(a)|^2"/> and <img class="math" src="_images/math/c706c86feba228634c736a8ead579c69bdf2e870.png" alt="|f'(b)|^2"/>. Note that</p>
<div class="math">
<p><img src="_images/math/266e0ac1f617112d1bd12fff4e6a38485f5fa5ad.png" alt="\left| \frac{d}{dx} f(x) \right|^2 &amp;= \left| \frac{d}{dx} \sum_{i=1}^n c_i B_i(x) \right|^2 \\
&amp;= \left| c^T B'(x) \right|^2 \\
&amp;= c^T B'(x) B'^T(x) c \\
&amp;= c^T A^{(1)}(x) c"/></p>
</div><p>where <img class="math" src="_images/math/c447c6b3d41f412f837e5e616ab1dd9c373d69e2.png" alt="A^{(1)}"/> is the <a class="reference internal" href="#sec-bspline-gram"><span class="std std-ref">outer product matrix</span></a> of first derivatives.
Therefore, our regularized least squares problem is</p>
<div class="math">
<p><img src="_images/math/036fde4fb31f3c2ae8a7baf604dcdf893d965f8d.png" alt="\min_{c} || y - X c ||_W^2 + \lambda^2 c^T A^{(1)}(a) c + \lambda^2 c^T A^{(1)}(b) c"/></p>
</div><p>where we have chosen to use the same regularization parameter <img class="math" src="_images/math/fc0c811948cbe72d26ba5a50f9b570c7a3581426.png" alt="\lambda^2"/> to regularize both
ends of the spline. In the example program below, we compute the unregularized solution (<img class="math" src="_images/math/332dcc848141e5b5423e96cc5a3fc78745a1b58f.png" alt="\lambda^2 = 0"/>)
and regularized solution (<img class="math" src="_images/math/fd39ecead91fd1197a0750f7450e02266e7511af.png" alt="\lambda^2 = 10"/>). The program outputs the first derivative of
the spline at both endpoints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unregularized</span> <span class="n">endpoint</span> <span class="n">deriv</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">1.081170e+01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.963725e+00</span><span class="p">]</span>
  <span class="n">regularized</span> <span class="n">endpoint</span> <span class="n">deriv</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">2.735857e-02</span><span class="p">,</span>  <span class="o">-</span><span class="mf">5.371758e-03</span><span class="p">]</span>
</pre></div>
</div>
<p>showing that the regularization has forced the first derivative smaller at both endpoints. The
results are shown in <a class="reference internal" href="#fig-bspline-lsend"><span class="std std-numref">Fig. 46</span></a>.</p>
<div class="figure align-default" id="id7">
<span id="fig-bspline-lsend"></span><a class="reference internal image-reference" href="_images/bspline_lsend.png"><img alt="_images/bspline_lsend.png" src="_images/bspline_lsend.png" style="width: 720.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 46 </span><span class="caption-text">Runge function B-spline least squares fit with exact (green), unregularized (red) and regularized (blue)
solutions. The zoomed inset views show the spline endpoints with <img class="math" src="_images/math/c8d7227a37bfb261f39b6ff29329fd2a011114ab.png" alt="1 \sigma"/> confidence intervals.</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_matrix.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_vector.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_linalg.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_rng.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_randist.h&gt;</span>

<span class="n">double</span>
<span class="n">f</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">25.0</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">));</span>
<span class="p">}</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>                                     <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">data</span> <span class="n">points</span> <span class="n">to</span> <span class="n">fit</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>                                      <span class="o">/*</span> <span class="n">spline</span> <span class="n">order</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>                                    <span class="o">/*</span> <span class="n">data</span> <span class="n">interval</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">;</span>                                <span class="o">/*</span> <span class="n">noise</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">lambda_sq</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">;</span>                            <span class="o">/*</span> <span class="n">regularization</span> <span class="n">parameter</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">nderiv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>                                  <span class="o">/*</span> <span class="n">derivative</span> <span class="n">order</span> <span class="n">to</span> <span class="n">regularize</span> <span class="n">at</span> <span class="n">endpoints</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">work</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>   <span class="o">/*</span> <span class="mi">20</span> <span class="n">breakpoints</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">p</span> <span class="o">=</span> <span class="n">gsl_bspline_ncontrol</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>              <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">control</span> <span class="n">points</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">control</span> <span class="n">points</span> <span class="k">for</span> <span class="n">unregularized</span> <span class="n">model</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">creg</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>                   <span class="o">/*</span> <span class="n">control</span> <span class="n">points</span> <span class="k">for</span> <span class="n">regularized</span> <span class="n">model</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">x</span> <span class="n">data</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">y</span> <span class="n">data</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">data</span> <span class="n">weights</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">XTX</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>                 <span class="o">/*</span> <span class="n">normal</span> <span class="n">equations</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">XTy</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>                    <span class="o">/*</span> <span class="n">normal</span> <span class="n">equations</span> <span class="n">rhs</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">cov</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>                 <span class="o">/*</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">cov_reg</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>             <span class="o">/*</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="k">for</span> <span class="n">regularized</span> <span class="n">model</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">A1</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>                  <span class="o">/*</span> <span class="n">left</span> <span class="n">regularization</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">A2</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>                  <span class="o">/*</span> <span class="n">right</span> <span class="n">regularization</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">gsl_rng</span> <span class="o">*</span><span class="n">r</span><span class="p">;</span>

  <span class="n">gsl_rng_env_setup</span><span class="p">();</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">gsl_rng_alloc</span><span class="p">(</span><span class="n">gsl_rng_default</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">fitted</span> <span class="o">*/</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">ui</span> <span class="o">=</span> <span class="n">gsl_rng_uniform</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
      <span class="n">double</span> <span class="n">xi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">ui</span> <span class="o">+</span> <span class="n">a</span><span class="p">;</span>
      <span class="n">double</span> <span class="n">yi</span><span class="p">,</span> <span class="n">dyi</span><span class="p">;</span>

      <span class="n">dyi</span> <span class="o">=</span> <span class="n">gsl_ran_gaussian</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">);</span>
      <span class="n">yi</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">+</span> <span class="n">dyi</span><span class="p">;</span>

      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">));</span>

      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>

      <span class="o">++</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">use</span> <span class="n">uniform</span> <span class="n">breakpoints</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="n">gsl_bspline_lsnormal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">XTy</span><span class="p">,</span> <span class="n">XTX</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span> <span class="o">/*</span> <span class="n">form</span> <span class="n">normal</span> <span class="n">equations</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_cholesky_band_decomp</span><span class="p">(</span><span class="n">XTX</span><span class="p">);</span>          <span class="o">/*</span> <span class="n">banded</span> <span class="n">Cholesky</span> <span class="n">decomposition</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_cholesky_band_solve</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">XTy</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>   <span class="o">/*</span> <span class="n">solve</span> <span class="k">for</span> <span class="n">unregularized</span> <span class="n">solution</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_covariance</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>        <span class="o">/*</span> <span class="n">compute</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="o">*/</span>

  <span class="o">/*</span> <span class="n">compute</span> <span class="n">regularization</span> <span class="n">matrices</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_oprod</span><span class="p">(</span><span class="n">nderiv</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">A1</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
  <span class="n">gsl_bspline_oprod</span><span class="p">(</span><span class="n">nderiv</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">multiply</span> <span class="n">by</span> <span class="k">lambda</span><span class="o">^</span><span class="mi">2</span> <span class="o">*/</span>
  <span class="n">gsl_matrix_scale</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">lambda_sq</span><span class="p">);</span>
  <span class="n">gsl_matrix_scale</span><span class="p">(</span><span class="n">A2</span><span class="p">,</span> <span class="n">lambda_sq</span><span class="p">);</span>

  <span class="n">gsl_bspline_lsnormal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">XTy</span><span class="p">,</span> <span class="n">XTX</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>  <span class="o">/*</span> <span class="n">form</span> <span class="n">normal</span> <span class="n">equations</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_matrix_add</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">A1</span><span class="p">);</span>                        <span class="o">/*</span> <span class="n">add</span> <span class="n">regularization</span> <span class="n">terms</span> <span class="o">*/</span>
  <span class="n">gsl_matrix_add</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">A2</span><span class="p">);</span>
  <span class="n">gsl_linalg_cholesky_band_decomp</span><span class="p">(</span><span class="n">XTX</span><span class="p">);</span>           <span class="o">/*</span> <span class="n">banded</span> <span class="n">Cholesky</span> <span class="n">decomposition</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_cholesky_band_solve</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">XTy</span><span class="p">,</span> <span class="n">creg</span><span class="p">);</span> <span class="o">/*</span> <span class="n">solve</span> <span class="k">for</span> <span class="n">regularized</span> <span class="n">solution</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_covariance</span><span class="p">(</span><span class="n">XTX</span><span class="p">,</span> <span class="n">cov_reg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>     <span class="o">/*</span> <span class="n">compute</span> <span class="n">covariance</span> <span class="n">matrix</span> <span class="o">*/</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">the</span> <span class="n">spline</span> <span class="n">curves</span> <span class="o">*/</span>
  <span class="p">{</span>
    <span class="n">double</span> <span class="n">xi</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">xi</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">;</span> <span class="n">xi</span> <span class="o">+=</span> <span class="mf">0.001</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">double</span> <span class="n">result_unreg</span><span class="p">,</span> <span class="n">result_reg</span><span class="p">;</span>
        <span class="n">double</span> <span class="n">err_unreg</span><span class="p">,</span> <span class="n">err_reg</span><span class="p">;</span>

        <span class="o">/*</span> <span class="n">compute</span> <span class="n">unregularized</span> <span class="n">spline</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">error</span> <span class="n">at</span> <span class="n">xi</span> <span class="o">*/</span>
        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result_unreg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
        <span class="n">gsl_bspline_err</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err_unreg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

        <span class="o">/*</span> <span class="n">compute</span> <span class="n">regularized</span> <span class="n">spline</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">error</span> <span class="n">at</span> <span class="n">xi</span> <span class="o">*/</span>
        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">creg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result_reg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
        <span class="n">gsl_bspline_err</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cov_reg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err_reg</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="s2"> </span><span class="si">%e</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
               <span class="n">xi</span><span class="p">,</span>
               <span class="n">f</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span>
               <span class="n">result_unreg</span><span class="p">,</span>
               <span class="n">err_unreg</span><span class="p">,</span>
               <span class="n">result_reg</span><span class="p">,</span>
               <span class="n">err_reg</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="p">{</span>
    <span class="n">double</span> <span class="n">result0</span><span class="p">,</span> <span class="n">result1</span><span class="p">;</span>

    <span class="n">gsl_bspline_calc_deriv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">nderiv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result0</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
    <span class="n">gsl_bspline_calc_deriv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">nderiv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result1</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;unregularized endpoint deriv %zu: [</span><span class="si">%14.6e</span><span class="s2">, </span><span class="si">%14.6e</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nderiv</span><span class="p">,</span> <span class="n">result0</span><span class="p">,</span> <span class="n">result1</span><span class="p">);</span>

    <span class="n">gsl_bspline_calc_deriv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">creg</span><span class="p">,</span> <span class="n">nderiv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result0</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
    <span class="n">gsl_bspline_calc_deriv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">creg</span><span class="p">,</span> <span class="n">nderiv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result1</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;  regularized endpoint deriv %zu: [</span><span class="si">%14.6e</span><span class="s2">, </span><span class="si">%14.6e</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">nderiv</span><span class="p">,</span> <span class="n">result0</span><span class="p">,</span> <span class="n">result1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">gsl_rng_free</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">creg</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">XTX</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">XTy</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">cov</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">cov_reg</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">A2</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-7-least-squares-and-periodic-splines">
<h3>Example 7: Least squares and periodic splines<a class="headerlink" href="#example-7-least-squares-and-periodic-splines" title="Permalink to this heading">¶</a></h3>
<p>The following example program fits B-spline curves to a dataset which is periodic.
Both a non-periodic and periodic spline are fitted to the data for comparison. The
data is derived from the function on <img class="math" src="_images/math/a72d3cd3c13fe84de3d730d119f7965720e2a8e1.png" alt="[0,2\pi]"/>,</p>
<div class="math">
<p><img src="_images/math/60bf8708494a6e8d0136c792b34c93483c794555.png" alt="f(x) = \sin{x} - \cos{2x}"/></p>
</div><p>with Gaussian noise added. The program fits order <img class="math" src="_images/math/11961be60856cc67a7eefeb873d13e5b08090a4f.png" alt="k=6"/> splines to the
dataset.</p>
<div class="figure align-default" id="id8">
<span id="fig-bspline-per"></span><a class="reference internal image-reference" href="_images/bspline_per.png"><img alt="_images/bspline_per.png" src="_images/bspline_per.png" style="width: 720.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 47 </span><span class="caption-text">Data (black) with non-periodic spline fit (red) and periodic spline fit (green).</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>The program additionally computes the derivatives up to order <img class="math" src="_images/math/f454321a282127207f057550d6235aa34434b444.png" alt="5"/> at
the endpoints <img class="math" src="_images/math/7a7473d91c1b569502878bc1d51c2d15f91d9a8e.png" alt="x=0"/> and <img class="math" src="_images/math/f9d607da1816b8421de53016f253c3c42560711a.png" alt="x=2\pi"/>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">===</span> <span class="n">Non</span><span class="o">-</span><span class="n">periodic</span> <span class="n">spline</span> <span class="n">endpoint</span> <span class="n">derivatives</span> <span class="o">===</span>
<span class="n">deriv</span> <span class="mi">0</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">8.697939e-01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">8.328553e-01</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">2.423132e+00</span><span class="p">,</span>   <span class="mf">4.277439e+00</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">3.904362e+01</span><span class="p">,</span>   <span class="mf">3.710592e+01</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">2.096142e+02</span><span class="p">,</span>   <span class="mf">2.036125e+02</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">7.240121e+02</span><span class="p">,</span>   <span class="mf">7.384888e+02</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">5</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">1.230036e+03</span><span class="p">,</span>   <span class="mf">1.294264e+03</span><span class="p">]</span>
<span class="o">===</span> <span class="n">Periodic</span> <span class="n">spline</span> <span class="n">endpoint</span> <span class="n">derivatives</span> <span class="o">===</span>
<span class="n">deriv</span> <span class="mi">0</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">1.022798e+00</span><span class="p">,</span>  <span class="o">-</span><span class="mf">1.022798e+00</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">1.041910e+00</span><span class="p">,</span>   <span class="mf">1.041910e+00</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">4.466384e+00</span><span class="p">,</span>   <span class="mf">4.466384e+00</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">1.356654e+00</span><span class="p">,</span>  <span class="o">-</span><span class="mf">1.356654e+00</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span> <span class="o">-</span><span class="mf">2.751544e+01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.751544e+01</span><span class="p">]</span>
<span class="n">deriv</span> <span class="mi">5</span><span class="p">:</span> <span class="p">[</span>  <span class="mf">5.055419e+01</span><span class="p">,</span>   <span class="mf">2.674261e+01</span><span class="p">]</span>
</pre></div>
</div>
<p>We can see that the periodic fit matches derivative values up
to order <img class="math" src="_images/math/e3ba1364d84493276f135cfc764ad33e3b6371d5.png" alt="4"/>, with the <img class="math" src="_images/math/f454321a282127207f057550d6235aa34434b444.png" alt="5"/>-th derivative being non-continuous.</p>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_rng.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_randist.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_statistics.h&gt;</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>              <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">data</span> <span class="n">points</span> <span class="n">to</span> <span class="n">fit</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">a</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>              <span class="o">/*</span> <span class="n">data</span> <span class="n">interval</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">M_PI</span><span class="p">;</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">spline_order</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>     <span class="o">/*</span> <span class="n">spline</span> <span class="n">order</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">ncontrol</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>        <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">control</span> <span class="n">points</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">noise</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc_ncontrol</span><span class="p">(</span><span class="n">spline_order</span><span class="p">,</span> <span class="n">ncontrol</span><span class="p">);</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">wper</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc_ncontrol</span><span class="p">(</span><span class="n">spline_order</span><span class="p">,</span> <span class="n">ncontrol</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">ncontrol</span><span class="p">);</span>    <span class="o">/*</span> <span class="n">non</span><span class="o">-</span><span class="n">periodic</span> <span class="n">coefficients</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">cper</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">ncontrol</span><span class="p">);</span> <span class="o">/*</span> <span class="n">periodic</span> <span class="n">coefficients</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">wts</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">gsl_rng</span> <span class="o">*</span><span class="n">r</span><span class="p">;</span>
  <span class="n">double</span> <span class="n">chisq</span><span class="p">;</span>

  <span class="n">gsl_rng_env_setup</span><span class="p">();</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">gsl_rng_alloc</span><span class="p">(</span><span class="n">gsl_rng_default</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">data</span> <span class="n">to</span> <span class="n">be</span> <span class="n">fitted</span> <span class="o">*/</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">xi</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">a</span><span class="p">;</span>
      <span class="n">double</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">xi</span><span class="p">);</span>
      <span class="n">double</span> <span class="n">dyi</span> <span class="o">=</span> <span class="n">gsl_ran_gaussian</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="p">);</span>

      <span class="n">yi</span> <span class="o">+=</span> <span class="n">dyi</span><span class="p">;</span>

      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">xi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
      <span class="n">gsl_vector_set</span><span class="p">(</span><span class="n">wts</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">));</span>

      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">use</span> <span class="n">uniform</span> <span class="n">non</span><span class="o">-</span><span class="n">periodic</span> <span class="n">knots</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">solve</span> <span class="n">least</span> <span class="n">squares</span> <span class="n">problem</span> <span class="k">for</span> <span class="n">non</span><span class="o">-</span><span class="n">periodic</span> <span class="n">spline</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_wlssolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wts</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">chisq</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">use</span> <span class="n">periodic</span> <span class="n">knots</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_periodic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">wper</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">solve</span> <span class="n">least</span> <span class="n">squares</span> <span class="n">problem</span> <span class="k">for</span> <span class="n">periodic</span> <span class="n">spline</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_pwlssolve</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">wts</span><span class="p">,</span> <span class="n">cper</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">chisq</span><span class="p">,</span> <span class="n">wper</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">the</span> <span class="n">spline</span> <span class="n">curves</span> <span class="o">*/</span>
  <span class="p">{</span>
    <span class="n">double</span> <span class="n">xi</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">xi</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">xi</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">;</span> <span class="n">xi</span> <span class="o">+=</span> <span class="mf">0.01</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">double</span> <span class="n">result</span><span class="p">,</span> <span class="n">result_per</span><span class="p">;</span>
        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">cper</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result_per</span><span class="p">,</span> <span class="n">wper</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">result_per</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;=== Non-periodic spline endpoint derivatives ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spline_order</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">result0</span><span class="p">,</span> <span class="n">result1</span><span class="p">;</span>

      <span class="n">gsl_bspline_calc_deriv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result0</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
      <span class="n">gsl_bspline_calc_deriv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result1</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>

      <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;deriv %zu: [</span><span class="si">%14.6e</span><span class="s2">, </span><span class="si">%14.6e</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">result0</span><span class="p">,</span> <span class="n">result1</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;=== Periodic spline endpoint derivatives ===</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spline_order</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">result0</span><span class="p">,</span> <span class="n">result1</span><span class="p">;</span>

      <span class="n">gsl_bspline_calc_deriv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cper</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result0</span><span class="p">,</span> <span class="n">wper</span><span class="p">);</span>
      <span class="n">gsl_bspline_calc_deriv</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">cper</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result1</span><span class="p">,</span> <span class="n">wper</span><span class="p">);</span>

      <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;deriv %zu: [</span><span class="si">%14.6e</span><span class="s2">, </span><span class="si">%14.6e</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">result0</span><span class="p">,</span> <span class="n">result1</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">cper</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">wper</span><span class="p">);</span>
  <span class="n">gsl_rng_free</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">wts</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-8-projecting-onto-the-b-spline-basis">
<h3>Example 8: Projecting onto the B-spline basis<a class="headerlink" href="#example-8-projecting-onto-the-b-spline-basis" title="Permalink to this heading">¶</a></h3>
<p>The following example program projects the function</p>
<div class="math">
<p><img src="_images/math/38208f057442df172ea1f7d9469ddc287e46dc4e.png" alt="f(x) = 3 x^3 - 2 x^2 - 7 x"/></p>
</div><p>onto a cubic B-spline basis with uniform knots on the interval <img class="math" src="_images/math/69932d7e96401e5be702cfc25938a2f08b8af0b3.png" alt="[-2,2]"/>.
Because the function is cubic, it can be exactly decomposed in the B-spline basis.</p>
<div class="figure align-default" id="id9">
<span id="fig-bspline-proj"></span><a class="reference internal image-reference" href="_images/bspline_proj.png"><img alt="_images/bspline_proj.png" src="_images/bspline_proj.png" style="width: 720.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 48 </span><span class="caption-text">Exact function (red) and spline projection (green). Small offset deliberately added to
green curve.</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_matrix.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_vector.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_linalg.h&gt;</span>

<span class="o">/*</span> <span class="n">function</span> <span class="n">to</span> <span class="n">be</span> <span class="n">projected</span> <span class="o">*/</span>
<span class="n">double</span>
<span class="n">f</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span> <span class="n">params</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">(</span><span class="n">void</span><span class="p">)</span> <span class="n">params</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">7.0</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span> <span class="o">+</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">x</span><span class="p">)));</span>
<span class="p">}</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>                                       <span class="o">/*</span> <span class="n">spline</span> <span class="n">order</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">;</span>                                    <span class="o">/*</span> <span class="n">spline</span> <span class="n">interval</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">work</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>   <span class="o">/*</span> <span class="mi">10</span> <span class="n">breakpoints</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="n">gsl_bspline_ncontrol</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>              <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">control</span> <span class="n">points</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">control</span> <span class="n">points</span> <span class="k">for</span> <span class="n">spline</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                      <span class="o">/*</span> <span class="n">rhs</span> <span class="n">vector</span> <span class="o">*/</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span><span class="n">G</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>                   <span class="o">/*</span> <span class="n">Gram</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_function</span> <span class="n">F</span><span class="p">;</span>

  <span class="n">F</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
  <span class="n">F</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>

  <span class="o">/*</span> <span class="n">use</span> <span class="n">uniform</span> <span class="n">breakpoints</span> <span class="n">on</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">compute</span> <span class="n">Gram</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_gram</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">construct</span> <span class="n">rhs</span> <span class="n">vector</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_proj_rhs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">F</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">solve</span> <span class="n">system</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_cholesky_band_decomp</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
  <span class="n">gsl_linalg_cholesky_band_solve</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">the</span> <span class="n">result</span> <span class="o">*/</span>
  <span class="p">{</span>
    <span class="n">double</span> <span class="n">x</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mf">0.01</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">double</span> <span class="n">result</span><span class="p">;</span>
        <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">GSL_FN_EVAL</span><span class="p">(</span><span class="o">&amp;</span><span class="n">F</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">result</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example-9-interpolation">
<h3>Example 9: Interpolation<a class="headerlink" href="#example-9-interpolation" title="Permalink to this heading">¶</a></h3>
<p>The following example program computes an interpolating
cubic B-spline for a set of data. It constructs the collocation
matrix for the dataset and factors it with a banded LU decomposition.
The results are shown in <a class="reference internal" href="#fig-bspline-interp"><span class="std std-numref">Fig. 49</span></a>.</p>
<div class="figure align-default" id="id10">
<span id="fig-bspline-interp"></span><a class="reference internal image-reference" href="_images/bspline_interp.png"><img alt="_images/bspline_interp.png" src="_images/bspline_interp.png" style="width: 720.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 49 </span><span class="caption-text">Data points are shown in black and interpolated spline in light blue.</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
<p>The program is given below.</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
<span class="c1">#include &lt;math.h&gt;</span>

<span class="c1">#include &lt;gsl/gsl_math.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_bspline.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_matrix.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_vector.h&gt;</span>
<span class="c1">#include &lt;gsl/gsl_linalg.h&gt;</span>

<span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>                  <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">data</span> <span class="n">to</span> <span class="n">interpolate</span> <span class="o">*/</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">x_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span> <span class="p">};</span>
  <span class="n">const</span> <span class="n">double</span> <span class="n">y_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.9</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span> <span class="p">};</span>
  <span class="n">gsl_vector_const_view</span> <span class="n">xv</span> <span class="o">=</span> <span class="n">gsl_vector_const_view_array</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
  <span class="n">gsl_vector_const_view</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">gsl_vector_const_view_array</span><span class="p">(</span><span class="n">y_data</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
  <span class="n">const</span> <span class="n">size_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>                                 <span class="o">/*</span> <span class="n">spline</span> <span class="n">order</span> <span class="o">*/</span>
  <span class="n">gsl_vector</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="n">gsl_vector_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>                <span class="o">/*</span> <span class="n">control</span> <span class="n">points</span> <span class="k">for</span> <span class="n">spline</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_workspace</span> <span class="o">*</span><span class="n">work</span> <span class="o">=</span> <span class="n">gsl_bspline_alloc_ncontrol</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
  <span class="n">gsl_matrix</span> <span class="o">*</span> <span class="n">XB</span> <span class="o">=</span> <span class="n">gsl_matrix_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="o">/*</span> <span class="n">banded</span> <span class="n">collocation</span> <span class="n">matrix</span> <span class="o">*/</span>
  <span class="n">gsl_vector_uint</span> <span class="o">*</span> <span class="n">ipiv</span> <span class="o">=</span> <span class="n">gsl_vector_uint_alloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">double</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span>

  <span class="o">/*</span> <span class="n">initialize</span> <span class="n">knots</span> <span class="k">for</span> <span class="n">interpolation</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_init_interp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">xv</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">compute</span> <span class="n">collocation</span> <span class="n">matrix</span> <span class="k">for</span> <span class="n">interpolation</span> <span class="o">*/</span>
  <span class="n">gsl_bspline_col_interp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">xv</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="n">XB</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">solve</span> <span class="n">linear</span> <span class="n">system</span> <span class="k">with</span> <span class="n">banded</span> <span class="n">LU</span> <span class="o">*/</span>
  <span class="n">gsl_linalg_LU_band_decomp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">XB</span><span class="p">,</span> <span class="n">ipiv</span><span class="p">);</span>
  <span class="n">gsl_linalg_LU_band_solve</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">XB</span><span class="p">,</span> <span class="n">ipiv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">yv</span><span class="o">.</span><span class="n">vector</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">the</span> <span class="n">data</span> <span class="o">*/</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">xi</span> <span class="o">=</span> <span class="n">x_data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">double</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">y_data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="o">/*</span> <span class="n">output</span> <span class="n">the</span> <span class="n">spline</span> <span class="o">*/</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">t</span> <span class="o">=</span> <span class="n">x_data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">x_data</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">t</span> <span class="o">+=</span> <span class="mf">0.005</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">double</span> <span class="n">result</span><span class="p">;</span>
      <span class="n">gsl_bspline_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="n">work</span><span class="p">);</span>
      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="n">gsl_vector_free</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
  <span class="n">gsl_bspline_free</span><span class="p">(</span><span class="n">work</span><span class="p">);</span>
  <span class="n">gsl_vector_uint_free</span><span class="p">(</span><span class="n">ipiv</span><span class="p">);</span>
  <span class="n">gsl_matrix_free</span><span class="p">(</span><span class="n">XB</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="references-and-further-reading">
<h2>References and Further Reading<a class="headerlink" href="#references-and-further-reading" title="Permalink to this heading">¶</a></h2>
<p>Further information on the algorithms described in this section can be
found in the following references,</p>
<ul class="simple">
<li><p>C. de Boor, <em>A Practical Guide to Splines</em> (2001), Springer-Verlag,
ISBN 0-387-95366-3.</p></li>
<li><p>L. L. Schumaker, <em>Spline Functions: Basic Theory</em>, 3rd edition,
Cambridge University Press, 2007.</p></li>
<li><p>P. Dierckx, <em>Algorithms for smoothing data with periodic and parametric splines</em>,
Computer Graphics and Image Processing, 20, 1982.</p></li>
<li><ol class="upperalpha simple" start="16">
<li><p>Dierckx, <em>Curve and surface fitting with splines</em>, Oxford University Press, 1995.</p></li>
</ol>
</li>
<li><p>M. S. Mummy, <em>Hermite interpolation with B-splines</em>,
Computer Aided Geometric Design, 6, 177–179, 1989.</p></li>
</ul>
<p>Further information of Greville abscissae and B-spline collocation
can be found in the following paper,</p>
<ul class="simple">
<li><p>Richard W. Johnson, Higher order B-spline collocation at the Greville
abscissae.  <em>Applied Numerical Mathematics</em>. vol.: 52, 2005, 63–75.</p></li>
</ul>
<p>A large collection of B-spline routines is available in the
PPPACK library available at <a class="reference external" href="http://www.netlib.org/pppack">http://www.netlib.org/pppack</a>,
which is also part of SLATEC.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="spmatrix.html" class="btn btn-neutral float-right" title="Sparse Matrices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="nls.html" class="btn btn-neutral float-left" title="Nonlinear Least-Squares Fitting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 1996-2024 The GSL Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>